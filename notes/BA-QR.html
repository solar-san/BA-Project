<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="solar-san">

<title>Quantile Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="BA-QR_files/libs/clipboard/clipboard.min.js"></script>
<script src="BA-QR_files/libs/quarto-html/quarto.js"></script>
<script src="BA-QR_files/libs/quarto-html/popper.min.js"></script>
<script src="BA-QR_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="BA-QR_files/libs/quarto-html/anchor.min.js"></script>
<link href="BA-QR_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="BA-QR_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="BA-QR_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="BA-QR_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="BA-QR_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<meta name="author" content="solar-san">
<meta name="image" property="https://raw.githubusercontent.com/solar-san/BA-Project/main/docs/figures/BA-Project_header.png">
<meta name="description" content="Notes on quantile regression for business analysts. It contains a self-contained introduction tje topic, with R code snippets and the necessary mathematical and statistical notation.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&amp;family=Fira+Code&amp;display=swap" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#quantiles" id="toc-quantiles" class="nav-link" data-scroll-target="#quantiles">Quantiles</a>
  <ul class="collapse">
  <li><a href="#sample-quantiles-and-sampling-distribution" id="toc-sample-quantiles-and-sampling-distribution" class="nav-link" data-scroll-target="#sample-quantiles-and-sampling-distribution">Sample Quantiles and Sampling Distribution</a></li>
  <li><a href="#quantiles-as-a-minimization-problem" id="toc-quantiles-as-a-minimization-problem" class="nav-link" data-scroll-target="#quantiles-as-a-minimization-problem">Quantiles as a Minimization Problem</a></li>
  <li><a href="#advantages-of-quantiles" id="toc-advantages-of-quantiles" class="nav-link" data-scroll-target="#advantages-of-quantiles">Advantages of quantiles</a></li>
  <li><a href="#quantile-based-summary-statistics" id="toc-quantile-based-summary-statistics" class="nav-link" data-scroll-target="#quantile-based-summary-statistics">Quantile-based Summary Statistics</a></li>
  </ul></li>
  <li><a href="#quantile-regression" id="toc-quantile-regression" class="nav-link" data-scroll-target="#quantile-regression">Quantile regression</a>
  <ul class="collapse">
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation">Estimation</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#multiple-independent-variables" id="toc-multiple-independent-variables" class="nav-link" data-scroll-target="#multiple-independent-variables">Multiple Independent variables</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference">Inference</a>
  <ul class="collapse">
  <li><a href="#iid-case" id="toc-iid-case" class="nav-link" data-scroll-target="#iid-case"><span class="math inline">iid</span> case</a></li>
  <li><a href="#non-iid-case" id="toc-non-iid-case" class="nav-link" data-scroll-target="#non-iid-case">Non-<span class="math inline">iid</span> case</a></li>
  </ul></li>
  <li><a href="#the-bootstrap" id="toc-the-bootstrap" class="nav-link" data-scroll-target="#the-bootstrap">The Bootstrap</a>
  <ul class="collapse">
  <li><a href="#bootstrap-confidence-intervals" id="toc-bootstrap-confidence-intervals" class="nav-link" data-scroll-target="#bootstrap-confidence-intervals">Bootstrap Confidence Intervals</a></li>
  <li><a href="#bootstrap-inference" id="toc-bootstrap-inference" class="nav-link" data-scroll-target="#bootstrap-inference">Bootstrap Inference</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#more-intepretation-of-the-quantile-regression" id="toc-more-intepretation-of-the-quantile-regression" class="nav-link" data-scroll-target="#more-intepretation-of-the-quantile-regression">More Intepretation of the Quantile Regression</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Quantile Regression</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>solar-san </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">December 27, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<p><img src="https://raw.githubusercontent.com/solar-san/BA-Project/main/docs/figures/BA-Project_header.png" class="img-fluid"></p>
<div class="cell">

</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<blockquote class="blockquote">
<p>What is <em>Business Analytics</em>? It is an applied discipline, tasked with gaining insight into business operations and helping to make better, fact-based decisions: a basic pillar of being <em>data-driven</em>. It combines Statistics, Computer Sciences, Management Science, Operational Research, and much more.</p>
</blockquote>
<p>It has three main components:</p>
<ol type="1">
<li><strong>Descriptive analytics</strong>: providing insight into business questions by summarizing and visualizing observed data. Typically based on simple summaries and charts<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</li>
<li><strong>Predictive analytics</strong>: providing insight into the possible future by extrapolating patterns found in the historical data. Typically making use of statistical or machine learning predictive models (remember the Statistical Learning and Data Analytic courses).</li>
<li><strong>Prescriptive analytics</strong>: providing ways to make the best possible decisions based on the available information.</li>
</ol>
<blockquote class="blockquote">
<p>What is the role of Quantile Regression in Business Analytics?</p>
</blockquote>
<p>The Ordinary-Least-Squares (OLS) based linear regression is a well-known approach when it comes to model relationships between variables, such as:</p>
<p><span id="eq-multlinreg"><span class="math display">
Y_i = \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + ... + \beta_p x_{p i + \epsilon_i}
\tag{1}</span></span></p>
<p>There are fundamental assumptions behind this model:</p>
<ul>
<li>Independence of observations and error terms.</li>
<li>The error terms are identically distributed.</li>
<li>We have <em>homoskedasticity</em> and <em>zero mean</em><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</li>
<li>Normality of errors, as in <span class="math inline">\epsilon \stackrel{iid} {\sim} N(0, \sigma^2_{\epsilon})</span><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</li>
</ul>
<p>The main focus is to estimate the <em>mean</em> of the distribution: all the assumptions lead to the following formula.</p>
<p><span id="eq-condlinreg"><span class="math display">
\mathbb{E} [Y_i \vert X = x_i] = \beta_0 + \beta_1 x_1 + ... + \beta_p x_p
\tag{2}</span></span></p>
<blockquote class="blockquote">
<p>Quantile regression allows to deal with data that cannot be described with a <em>normal distribution</em> and that can be summarised effectively using the <em>mean</em><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
</blockquote>
<p>The main consequence of having homoskedastic and normal errors are:</p>
<ul>
<li>Symmetry.</li>
<li>If the mean and scaled are known, we can assume that we know the whole distribution. Therefore, knowing <em>how the mean changes</em> explains <em>all the changes in the distribution</em>.</li>
</ul>
<p>However, this is often not the case:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>incomeEx <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pathmaker</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"data/incomeSurvey.csv"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 10111 Columns: 10
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (4): eth, htype, ced, rural
dbl (6): age, ed, hkids, cinc, lcinc, hid

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>incomeEx<span class="sc">$</span>income <span class="ot">&lt;-</span> incomeEx<span class="sc">$</span>cinc<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  incomeEx</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      income</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># color = "grey50", </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill  =</span> <span class="st">"grey70"</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">yintercept =</span> <span class="fu">seq</span>(</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2000</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="dv">500</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"white"</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Income"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Income (100s USD)"</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="{callout.important}">
<p>Many variables are <em>not</em> symmetric. Moreover, we are often not only interested in the <em>mean</em>, but in understanding <em>extremes</em>. Since linear regression model cannot give the full description of the distribution and everything is described by its mean, we need an alternative Framework.</p>
</div>
<p>We do not need to forget that linear regression is appropriate for several applications and comes with many practical and theoretical reason to explain its widespread adoption. For example, it is computationally feasible and easy to implement and can be adapted to handle heteroskedasticity and robustness. Moreover, it can be <em>generalized</em> to handle the non-gaussian case and even non-linearity<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.</p>
</section>
<section id="quantiles" class="level1">
<h1>Quantiles</h1>
<p><em>Quantiles</em> are defined mathematically as:</p>
<p><span id="eq-quantile"><span class="math display">
Q(p) = \mathrm{inf} \{ x: P(X \leq x) \geq p \}
\tag{3}</span></span></p>
<p>This is strictly related to the <em>cumulative distribution function</em>. The quantile of order <span class="math inline">\alpha</span> can also be interpred as that point in the distribution for which you have a probability <span class="math inline">\alpha</span> of observing a value less than that quantile<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<p>We can compute a set of quantiles to help prove the point. Note that the mean of the distribution is 47.0563867.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pquant <span class="ot">&lt;-</span> <span class="fu">quantile</span>(incomeEx <span class="sc">%&gt;%</span> <span class="fu">pull</span>(income), <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>pquant</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     10%      25%      50%      75%      90% 
11.64731 21.86632 39.18834 63.15703 92.93739 </code></pre>
</div>
</div>
<p>There is a noticeable positive difference between <em>median</em> and <em>mean</em>, indicating a right-skewed distribution. Computing such differences helps in understanding the <em>shape</em> of our distribution.</p>
<p>We notice that the difference between the 75th and the 50th quantile is larger than the difference between the 50th and the 25th percentile: this is an indication of an asymmetry in the distribution. The same goes when comparing the the more extreme tails (e.g.&nbsp;the 10th and 90th quantile):</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pquant[<span class="dv">4</span>]<span class="sc">-</span> pquant[<span class="dv">3</span>]; pquant[<span class="dv">3</span>] <span class="sc">-</span> pquant[<span class="dv">2</span>]  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     75% 
23.96869 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     50% 
17.32201 </code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pquant[<span class="dv">5</span>]<span class="sc">-</span> pquant[<span class="dv">3</span>]; pquant[<span class="dv">3</span>] <span class="sc">-</span> pquant[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     90% 
53.74905 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     50% 
27.54102 </code></pre>
</div>
</div>
<p>Quantiles are not only <em>theoretical</em>: we can build an <em>Empirical Cumulative Distribution Function</em> that describes the cumulative <em>frequencies</em> of the observed values in our data.</p>
<p>For example, for an <span class="math inline">iid</span> sample:</p>
<p><span id="eq-ECDF"><span class="math display">
\hat F = \frac{\mathrm{number \ of \ observations} \leq t}{n}
\tag{4}</span></span></p>
<section id="sample-quantiles-and-sampling-distribution" class="level2">
<h2 class="anchored" data-anchor-id="sample-quantiles-and-sampling-distribution">Sample Quantiles and Sampling Distribution</h2>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we wish to make inference we need to account for uncertainty.</p>
</div>
</div>
<p>The quantiles can be <em>estimated</em> by inverting the <em>ECDF</em>: this amounts to finding <span class="math inline">Q(p)</span> for a given <span class="math inline">p</span> and, even if the function is <em>discrete</em>, we can extrapolate between the jumps. However, we need to take into account the sampling distribution to make any inference about the characteristic of interest and their distribution shape in the population we are sampling from.</p>
<p>Asymptotic results shows that, for an <em>identically and independently distributed</em> (<span class="math inline">iid</span>) sample, being <span class="math inline">f(x)</span> the <em>probability density function</em> and <span class="math inline">Q(p)</span> the <em>quantile function</em>:</p>
<p><span id="eq-quantileasymptotic"><span class="math display">
\hat Q \stackrel{\mathrm{approx}}{\sim} N \left ( Q(p), \sqrt{\frac{(1- p)p}{n} \frac{1}{f(Q(p))^2}} \right )
\tag{5}</span></span></p>
<p>This function depends on the unknown: probability density function, <span class="math inline">n</span>, and <span class="math inline">p</span>.</p>
</section>
<section id="quantiles-as-a-minimization-problem" class="level2">
<h2 class="anchored" data-anchor-id="quantiles-as-a-minimization-problem">Quantiles as a Minimization Problem</h2>
<p>Quantiles can be considered as a solution to a certain minimization problem; for example, the mean is defined as:</p>
<p><span id="eq-medianargmin"><span class="math display">
x_{0.5} = \underset{c}{\mathrm{argmin}} \ \mathbb{E} [ \ \vert Y - c \vert \ ]
\tag{6}</span></span></p>
<p>A more general formula is:</p>
<p><span id="eq-quantileargmin1"><span class="math display">
Q(p) = \underset{c}{\mathrm{argmin}} \ \mathbb{E} [d_p(Y, c)]
\tag{7}</span></span></p>
<p>Where:</p>
<p><span id="eq-quantileargmin2"><span class="math display">
d_p (Y, c) =
\begin{cases}
\begin{aligned}
(1 -p) \ \vert Y - c \vert \qquad \mathrm{for} \ Y &amp;&lt; c \\
p \ \vert Y - c \vert \qquad \mathrm{for} \ Y &amp;\geq c
\end{aligned}
\end{cases}
\tag{8}</span></span></p>
<p>If we are dealing with <em>sample</em> quantiles instead, we find <span class="math inline">Q(p)</span> as the value that minimises:</p>
<p><span id="eq-quantilesample"><span class="math display">
\frac{1}{n} \sum^n_{i=1} d_p(y_i, c) = \frac{1 - p}{n} \sum_{y_i &lt; q} \ \vert y_i - q \vert + \frac{p}{n} \sum_{y_i &gt; q} \ \vert y_i - q \vert
\tag{9}</span></span></p>
<p>Each point contributes to a certain value and we can represent a <em>loss function</em>.</p>
</section>
<section id="advantages-of-quantiles" class="level2">
<h2 class="anchored" data-anchor-id="advantages-of-quantiles">Advantages of quantiles</h2>
<ul>
<li>The mean, standard deviantion, and skewness are <em>not robust</em>: they are highly sensitive to <em>outliers</em>.</li>
<li>Quantiles are <em>equivariant</em> to non-decreasing transformation.</li>
</ul>
<p>A function is non decreasing if <span class="math inline">h(b) \geq h(a)</span> if <span class="math inline">b&gt;a</span><a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>. This property implies that <span class="math inline">Q(p, h(Y)) = h(Q(p, Y))</span><a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>.</p>
</section>
<section id="quantile-based-summary-statistics" class="level2">
<h2 class="anchored" data-anchor-id="quantile-based-summary-statistics">Quantile-based Summary Statistics</h2>
<p>Quantiles allow to describe the <em>scale</em> and <em>shape</em> of distributions.</p>
<p>Scale can be summarised with a <em>quantile-based scale</em> measure (<strong>QSC</strong>) at a selected <span class="math inline">p</span>:</p>
<p><span id="eq-QSC"><span class="math display">
QSC(p) = Q(1 - p) - Q(p) \ \mathrm{for} \ p &lt; 0.5
\tag{10}</span></span></p>
<p>The <em>interquartile range</em> (IQR) corresponds to QSC(0.25).</p>
<p>Skewness can be summarised with a <em>quantile-based skewness</em> (<strong>QSK</strong>) or <em>asymmetry</em> index:</p>
<p><span id="eq-QSK"><span class="math display">
QSK(p) = \frac{Q(1 - p) - Q(.5)}{Q(.5) - Q(p)} - 1\ \mathrm{for} \ p &lt; 0.5
\tag{11}</span></span></p>
<p>If <span class="math inline">QSK(p) &gt; 0</span>, we have <em>right-skewness</em>.</p>
</section>
</section>
<section id="quantile-regression" class="level1">
<h1>Quantile regression</h1>
<blockquote class="blockquote">
<p>We are modeling the <span class="math inline">\tau</span> quantile of a distribution as a function of the <em>conditional quantile</em> <span class="math inline">X</span>.</p>
</blockquote>
<p>The <em>linear quantile regression</em> model (<strong>QRM</strong>) is:</p>
<p><span id="eq-QRMcond"><span class="math display">
Q_{\tau} (Y \vert X) = \beta_0^{(\tau)} + \beta_1^{(\tau)} X
\tag{12}</span></span></p>
<p>If we assume that <span class="math inline">\epsilon^{(\tau)}</span> is a <em>random variable</em> such that <span class="math inline">Q_{\tau} (\epsilon^{(\tau)} \vert X) = 0</span> we can rewrite the previous equation as:</p>
<p><span id="eq-QRMlin"><span class="math display">
Y = \beta_0^{(\tau)} + \beta_1^{(\tau)} X + \epsilon^{(\tau)}
\tag{13}</span></span></p>
<p>Choosing <span class="math inline">\tau</span> determines the type of QRM: for <span class="math inline">\tau = 0.5</span>, we have a <em>median regression</em>.</p>
<section id="estimation" class="level2">
<h2 class="anchored" data-anchor-id="estimation">Estimation</h2>
<p>If we have pairs of independently sampled observations <span class="math inline">(x_i, y_i)</span>, for <span class="math inline">i = 1, ..., n</span>, the QRM leads to <span class="math inline">y_i = \beta_0^{(\tau)} + \beta_1^{(\tau)} x_i + \epsilon_i^{(\tau)}</span>.</p>
<p>Based on the sampled points, we need a way to fit the function: we need an estimator for <span class="math inline">\beta^{(\tau)} = (\beta_0^{(\tau)}, \beta_1^{(\tau)})</span>.</p>
<p>The median regression model estimates are such as to minimise<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>:</p>
<p><span id="eq-QRMmedianloss"><span class="math display">
\sum^n_{i = 1} \vert y_i - a - bx_i \vert
\tag{14}</span></span></p>
<p>More generally:</p>
<p><span id="eq-QRMloss1"><span class="math display">
\sum^n_{i = 1} d_{\tau} (y_i, a + b x_i)
\tag{15}</span></span></p>
<p>where:</p>
<p><span id="eq-QRMloss2"><span class="math display">
d_{\tau} (y_i, a + b x_i) =
\begin{cases}
\begin{aligned}
(1 - \tau) \vert y_i - a - bx_i \vert \qquad \mathrm{for} \ y_i &lt; a + b x_i \\
\tau \vert y_i - a - bx_i \vert \qquad \mathrm{for} \ y_i \geq a + b x_i
\end{aligned}
\end{cases}
\tag{16}</span></span></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Minimisation is achieved with <em>linear programming</em> methods. The solution <em>might be not unique</em>.</p>
</div>
</div>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<p>We will use Engel food expenditure data used in Koenker and Bassett(1982). This is a regression dataset consisting of 235 observations on income and expenditure on food for Belgian working class households.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(engel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plotting the dataset:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> engel, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> income, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> foodexp</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Engel food expenditure data"</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>We need the <code>quantreg</code> dataset to perform QRM. The function <code>geom_quantile()</code> can be used to compare the standard linear regression fit and the median fit:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> engel, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> income,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> foodexp</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>, </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"limegreen"</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>      ), </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">FALSE</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_quantile</span>(</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fl">0.5</span>, </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"dodgerblue"</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Engel food expenditure data - mean and median regression"</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">'Regression type:'</span>,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span><span class="fu">c</span>(</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">'limegreen'</span><span class="ot">=</span><span class="st">'limegreen'</span>,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dodgerblue'</span><span class="ot">=</span><span class="st">'dodgerblue'</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>      ), </span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Linear Regression'</span>,</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Median Regression'</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
Smoothing formula not specified. Using: y ~ x</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>The following plot represents a set of <em>deciles regressions</em>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> engel, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> income,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> foodexp</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Engel food expenditure data"</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_quantile</span>(</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">seq</span>(</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>      .<span class="dv">1</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>      .<span class="dv">9</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">by=</span><span class="fl">0.1</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>      ), </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"indianred"</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Smoothing formula not specified. Using: y ~ x</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<blockquote class="blockquote">
<p>With this approach we can clearly see that expenditure on food is <em>not</em> the same in the different quantiles.</p>
</blockquote>
<p>By default <code>geom_quantile</code> shows the quartile fits<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> engel, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> income, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> foodexp</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Engel food expenditure data"</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_quantile</span>(</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"dodgerblue"</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Smoothing formula not specified. Using: y ~ x</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<blockquote class="blockquote">
<p>What are the implications of different <span class="math inline">\beta_1^{(\tau)}</span> slopes?</p>
</blockquote>
<p>If we take two models for <span class="math inline">\tau = p</span> and <span class="math inline">\tau = q</span> and rearrange the two equations, having the same data points <span class="math inline">(y_i, x_i)</span>, we obtain:</p>
<p><span id="eq-slopedifferences1"><span class="math display">
(\epsilon_i^{(p)} - \epsilon_i^{(q)}) = (\beta_0^{(p)} - \beta_0^{(q)}) + (\beta_1^{(p)} - \beta_1^{(q)})x_i
\tag{17}</span></span></p>
<p>The difference between the two errors depend on <span class="math inline">x_i</span>. If the two slopes are equal<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>, then the two errors differ only by a constant: hence, the quantile error distribution only differ for a constant. This means that the observations are identically distributed for different values of <span class="math inline">X</span>.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>QRM can be used to assess whether the assumption of <em>identically distributed</em> observations is valid.</p>
</div>
</div>
<p>Note that, however, to formally test the equality of slopes we need a way to make <em>inference</em>.</p>
</section>
<section id="multiple-independent-variables" class="level2">
<h2 class="anchored" data-anchor-id="multiple-independent-variables">Multiple Independent variables</h2>
<p>We can extend the model and obtain a <em>multivariate</em> quantle regression. In the (compact) matrix notation we have:</p>
<p><span id="eq-multiQRM"><span class="math display">
Q_{\tau} = (Y \vert \mathbf{X}) = \mathbf{X} \mathbf{\beta}^{(\tau)} + \epsilon_i^{\tau}
\tag{18}</span></span></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The coefficients <span class="math inline">\mathbf{\beta}^{(\tau)}</span> can be interpreted as the effect of <span class="math inline">x</span> on the quantile once the effect of other variables is also taken into account.</p>
</div>
</div>
<p>Again, we need a way to assess the significance of each added variable: in other words, a way to make <em>inference</em>.</p>
</section>
<section id="inference" class="level2">
<h2 class="anchored" data-anchor-id="inference">Inference</h2>
<section id="iid-case" class="level3">
<h3 class="anchored" data-anchor-id="iid-case"><span class="math inline">iid</span> case</h3>
<blockquote class="blockquote">
<p>Does the addition of a variable <span class="math inline">x_j</span> <em>improve</em> the goodness of fit?</p>
</blockquote>
<p>There are two approaches to conduct inference in the context of quantile regression:</p>
<ol type="1">
<li>With lots of mathematics we can derive some asymptotic results for <span class="math inline">\beta^{(\tau)}</span>.</li>
<li>Another option is to use <em>simulation based inference</em>, such as <strong>the bootstrap</strong>.</li>
</ol>
<p>For <span class="math inline">iid</span> observations it can be shown that, under some weak conditions:</p>
<p><span id="eq-inference"><span class="math display">
\sqrt{n} (\hat \beta - \beta) \stackrel{d} {\to} N( 0, \mathbf{\Sigma})
\tag{19}</span></span></p>
<p><span class="math inline">\mathbf{\Sigma}</span> is the <em>variance-covariance</em> matrix of form:</p>
<p><span id="eq-inferencevarcovarmatrix"><span class="math display">
\mathbf{\Sigma} = \frac{\tau(1 - \tau)}{f_{\epsilon (\tau)}} (\mathbf{X}^T \mathbf{X})^{-1}
\tag{20}</span></span></p>
<p>The term <span class="math inline">f_{\epsilon (\tau)}</span> is the <em>pdf</em> of the error term <span class="math inline">\epsilon (\tau)</span> evaluated at the <span class="math inline">\tau^{th}</span> quantile of the error distribution, which we assumed to be 0.</p>
</section>
<section id="non-iid-case" class="level3">
<h3 class="anchored" data-anchor-id="non-iid-case">Non-<span class="math inline">iid</span> case</h3>
<p>The form of <span class="math inline">\mathbf{\Sigma}</span> for the non-identically distributed case is fairly complex.</p>
<p>In general, the mathematics is difficult and it is not always possible to derive asymptotic variances analytically. Hence, a simulation-based method such as the <strong>bootstrap</strong> is required.</p>
</section>
</section>
<section id="the-bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="the-bootstrap">The Bootstrap</h2>
<blockquote class="blockquote">
<p><strong>Bootstrapping</strong><a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a> is <em>any test or metric that uses random sampling with replacement</em>, mimicking the sampling process, and falls under the broader class of <em>resampling methods</em>. Bootstrapping assigns <em>measures of accuracy</em><a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a> to sample estimates. This technique allows estimation of the sampling distribution of almost any statistic using random sampling methods.</p>
</blockquote>
<p>It is based on the sample data and having <em>enough</em> computing power. The key idea is that we assume the population is just many copies of the sample; then, we make lots of copies of the sample and then we sample repeatedly from the population. In practice, instead of actually making many copies of the sample and sampling from that, we use a sampling technique that is equivalent, based on <em>sampling with replacement</em>.</p>
<p>In particular, we will use <strong>non parametric resampling bootstrap</strong>.</p>
<ul>
<li>We sample <em>with replacement</em> from the original sample.</li>
<li>Each sample selected is called a <em>bootstrap sample</em>.</li>
<li>For each bootstrap sample, we compute the estimate of the parameter, giving us a <em>bootstrap estimate</em>.</li>
<li>We collect the bootstrap estimates for many bootstrap samples to create a <em>bootstrap distribution</em> which we use as a <em>sampling distribution</em> for the estimate.</li>
</ul>
<section id="bootstrap-confidence-intervals" class="level3">
<h3 class="anchored" data-anchor-id="bootstrap-confidence-intervals">Bootstrap Confidence Intervals</h3>
<p>We can construct confidence intervals by bootstrap.</p>
<blockquote class="blockquote">
<p>When a bootstrap distribution for an estimate is <strong>symmetric</strong> and <strong>bell-shaped</strong>, we calculate a <span class="math inline">1 − \alpha</span>% confidence interval using:</p>
</blockquote>
<p><span id="eq-CIsymmetricbootstrap"><span class="math display">
\left [\hat \theta - q_{1- \frac{\alpha}{2}} \times \mathrm{sd_{boot}},
\hat \theta + q_{1- \frac{\alpha}{2}} \times \mathrm{sd_{boot}} \right ]
\tag{21}</span></span></p>
<p>where <span class="math inline">\mathrm{sd_{boot}}</span> denotes the standard deviation of the bootstrap estimates.</p>
<blockquote class="blockquote">
<p>When a bootstrap distribution for an estimate is <strong><em>not</em> symmetric</strong> we calculate a <span class="math inline">1 − \alpha</span>% confidence interval using:</p>
</blockquote>
<p><span id="eq-CIasymmetricbootstrap"><span class="math display">
\left [\theta_{\mathrm{boot}} \left (\frac{\alpha}{2} \right),
\theta_{\mathrm{boot}}\left (1 - \frac{\alpha}{2} \right) \right]
\tag{22}</span></span></p>
<p>These two extremes denote the <span class="math inline">\alpha/2</span> and <span class="math inline">1 - \alpha/2</span> <em>empirical quantiles</em> of the bootstrap estimates.</p>
</section>
<section id="bootstrap-inference" class="level3">
<h3 class="anchored" data-anchor-id="bootstrap-inference">Bootstrap Inference</h3>
<p>Using the <em>standard error</em> derived with the bootstrap samples we can build a test on <span class="math inline">\beta_j^{\tau}</span><a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a>, in the form</p>
<p><span id="eq-bootstrapinference"><span class="math display">
\begin{cases}
\begin{aligned}
H_0: B_j = 0 \\
H_1 : B_j \neq 0
\end{aligned}
\end{cases}
\tag{23}</span></span></p>
<p>Under the null hypothesis, our null statistic is:</p>
<p><span id="eq-teststatistic"><span class="math display">
TS_{B_j} = \frac{\hat \beta_j}{se(B_j)} \sim N(0, 1)
\tag{24}</span></span></p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>We estimate <span class="math inline">se(\beta_j)</span> with the bootstrap or with some theoretical derivation: hence, we need to compare the test statistic against a <span class="math inline">T</span> distribution with <span class="math inline">n − (p + 1)</span> degrees of freedom.</p>
</div>
</div>
<p>Inference on single coefficient is often useful; however, we wish to test other hypothesis and also a to test <em>set</em> of hypothesis.</p>
<p>For a QR model for a single quantile τ we can have two different <em>nested model</em> structures; for <span class="math inline">q \geq p</span>:</p>
<p><span id="eq-nestedmodels"><span class="math display">
\begin{aligned}
\mathrm{Model \ 0}: \qquad Q_{\tau} (Y \vert X_1, …, X_q) = \beta_0^{\tau} + \beta_1^{\tau} X_1 + … + \beta_q^{\tau} \\
\mathrm{Model \ 1}: \qquad Q_{\tau} (Y \vert X_1, …, X_p) = \beta_0^{\tau} + \beta_1^{\tau} X_1 + … + \beta_p^{\tau} \\
\end{aligned}
\tag{25}</span></span></p>
<p>Note that <em>Model 1</em> reduces to <em>Model 2</em> when <span class="math inline">\beta_{p + 1} = … = \beta_q = 0</span>.</p>
<p>We are interested in constructing a test to verify the following null hypothesis<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a>:</p>
<p><span id="eq-nestedinference"><span class="math display">
\begin{cases}
\begin{aligned}
H_0: B_{p + 1} = … = \beta_q = 0 \\
H_1: B_{p + 1} = … = \beta_q \neq 0
\end{aligned}
\end{cases}
\tag{26}</span></span></p>
<p>This null hypothesis can be tested through an ANOVA test, based on the asymptotic <em>normality</em>.</p>
<p>Another important test might involve the comparison of the slopes of <span class="math inline">\beta^{(p)}_1</span> and <span class="math inline">\beta^{(q)}_1</span>, under the assumption of <em>identically distributed</em> data. In this case, we are comparing models for <em>different quantiles</em>; if we have one explanatory variable, then:</p>
<p><span id="eq-slopecomparison"><span class="math display">
\begin{aligned}
\mathrm{Model \ 1}: Q_{q} (Y \vert X) = \beta_0^{(q)} + \beta_1^{(q)} X \\
\mathrm{Model \ 2}: Q_{p} (Y \vert X) = \beta_0^{(p)} + \beta_1^{(p)} X
\end{aligned}
\tag{27}</span></span></p>
<p>We are interested in the following hypothesis:</p>
<p><span id="eq-slopetest"><span class="math display">
\begin{cases}
\begin{aligned}
H_0: B_{p} = B_{q} \\
H_1: B_{p} \neq B_{q}
\end{aligned}
\end{cases}
\tag{28}</span></span></p>
<p>Again, this test can be performed via ANOVA, based on the asymptotic normality.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>we should test for <em>more</em> that two quantiles; formal testing gives <em>evidence</em> of varying slopes.</p>
</div>
</div>
</section>
</section>
</section>
<section id="more-intepretation-of-the-quantile-regression" class="level1">
<h1>More Intepretation of the Quantile Regression</h1>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Any predictive or prescriptive model is based on some steps of <em>descriptive analytics</em>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This last one, however, is not strictly necessary.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This assumption allows for inference on the model parameters.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Warning: the mean is <em>not</em> a robust indicator of position.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Generalized Linear Models.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>In other words, it determines a specific point in the distribution. For example, the <em>median</em> is the quantile of order 0.5: you have a <span class="math inline">50%</span> probability of observing a value lower than the median.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>The basic example is a <em>linear transformation</em>, but this property also applies to <em>logarithms</em>.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>For example, <span class="math inline">Q(p, a + bY) = a + bQ(p, Y)</span>.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>This is the same <em>loss function</em> used to find the median.s<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p><span class="math inline">\tau = c(0.25, 0.5, 0.75)</span>.<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p><span class="math inline">(\beta_1^{(p)} - \beta_1^{(q)}) = 0</span>.<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>First introduced by Bradley Efron in the late 70s.<a href="#fnref12" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn13"><p>bias, variance, confidence intervals, prediction error, etc.<a href="#fnref13" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn14"><p>In the following notation the <span class="math inline">\tau</span> is omitted for readability.<a href="#fnref14" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn15"><p>This test amounts to asking the question: “Are the added variables <em>significant</em> in explaining the behaviour of our dependent variable?”<a href="#fnref15" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>