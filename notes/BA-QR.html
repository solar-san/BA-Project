<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="solar-san">

<title>Quantile Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="BA-QR_files/libs/clipboard/clipboard.min.js"></script>
<script src="BA-QR_files/libs/quarto-html/quarto.js"></script>
<script src="BA-QR_files/libs/quarto-html/popper.min.js"></script>
<script src="BA-QR_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="BA-QR_files/libs/quarto-html/anchor.min.js"></script>
<link href="BA-QR_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="BA-QR_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="BA-QR_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="BA-QR_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="BA-QR_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<meta name="author" content="solar-san">
<meta name="image" property="https://raw.githubusercontent.com/solar-san/BA-Project/main/docs/figures/BA-Project_header.png">
<meta name="description" content="Notes on quantile regression for business analysts. It contains a self-contained introduction to the topic, with R code snippets and the necessary mathematical and statistical notation.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&amp;family=Fira+Code&amp;display=swap" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-intro" id="toc-sec-intro" class="nav-link active" data-scroll-target="#sec-intro">Introduction</a></li>
  <li><a href="#quantiles" id="toc-quantiles" class="nav-link" data-scroll-target="#quantiles">Quantiles</a>
  <ul class="collapse">
  <li><a href="#sample-quantiles-and-sampling-distribution" id="toc-sample-quantiles-and-sampling-distribution" class="nav-link" data-scroll-target="#sample-quantiles-and-sampling-distribution">Sample Quantiles and Sampling Distribution</a></li>
  <li><a href="#quantiles-as-a-minimization-problem" id="toc-quantiles-as-a-minimization-problem" class="nav-link" data-scroll-target="#quantiles-as-a-minimization-problem">Quantiles as a Minimization Problem</a></li>
  <li><a href="#advantages-of-quantiles" id="toc-advantages-of-quantiles" class="nav-link" data-scroll-target="#advantages-of-quantiles">Advantages of quantiles</a></li>
  <li><a href="#sec-quantilebasedssunivariate" id="toc-sec-quantilebasedssunivariate" class="nav-link" data-scroll-target="#sec-quantilebasedssunivariate">Quantile-based Summary Statistics</a>
  <ul class="collapse">
  <li><a href="#computing-the-qsk-and-qsc" id="toc-computing-the-qsk-and-qsc" class="nav-link" data-scroll-target="#computing-the-qsk-and-qsc">Computing the QSK and QSC</a></li>
  <li><a href="#analysing-known-distributions" id="toc-analysing-known-distributions" class="nav-link" data-scroll-target="#analysing-known-distributions">Analysing Known Distributions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#quantile-regression" id="toc-quantile-regression" class="nav-link" data-scroll-target="#quantile-regression">Quantile regression</a>
  <ul class="collapse">
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation">Estimation</a></li>
  <li><a href="#example-engel-food-expenditure-data" id="toc-example-engel-food-expenditure-data" class="nav-link" data-scroll-target="#example-engel-food-expenditure-data">Example: Engel Food Expenditure Data</a></li>
  <li><a href="#interpreting-the-slope-difference" id="toc-interpreting-the-slope-difference" class="nav-link" data-scroll-target="#interpreting-the-slope-difference">Interpreting the Slope Difference</a></li>
  <li><a href="#multiple-independent-variables" id="toc-multiple-independent-variables" class="nav-link" data-scroll-target="#multiple-independent-variables">Multiple Independent variables</a>
  <ul class="collapse">
  <li><a href="#example-munich-rent-data" id="toc-example-munich-rent-data" class="nav-link" data-scroll-target="#example-munich-rent-data">Example: Munich Rent data</a></li>
  </ul></li>
  <li><a href="#sec-inference" id="toc-sec-inference" class="nav-link" data-scroll-target="#sec-inference">Inference</a>
  <ul class="collapse">
  <li><a href="#iid-case" id="toc-iid-case" class="nav-link" data-scroll-target="#iid-case"><span class="math inline">iid</span> case</a></li>
  <li><a href="#non-iid-case" id="toc-non-iid-case" class="nav-link" data-scroll-target="#non-iid-case">Non-<span class="math inline">iid</span> case</a></li>
  </ul></li>
  <li><a href="#the-bootstrap" id="toc-the-bootstrap" class="nav-link" data-scroll-target="#the-bootstrap">The Bootstrap</a>
  <ul class="collapse">
  <li><a href="#bootstrap-confidence-intervals" id="toc-bootstrap-confidence-intervals" class="nav-link" data-scroll-target="#bootstrap-confidence-intervals">Bootstrap Confidence Intervals</a></li>
  <li><a href="#bootstrap-inference" id="toc-bootstrap-inference" class="nav-link" data-scroll-target="#bootstrap-inference">Bootstrap Inference</a></li>
  <li><a href="#example-bootstrap" id="toc-example-bootstrap" class="nav-link" data-scroll-target="#example-bootstrap">Example: Bootstrap</a></li>
  <li><a href="#example-bootstrap-for-quantile-regression" id="toc-example-bootstrap-for-quantile-regression" class="nav-link" data-scroll-target="#example-bootstrap-for-quantile-regression">Example: Bootstrap for Quantile Regression</a></li>
  </ul></li>
  <li><a href="#example-inference-bootstrap" id="toc-example-inference-bootstrap" class="nav-link" data-scroll-target="#example-inference-bootstrap">Example: Inference &amp; Bootstrap</a></li>
  </ul></li>
  <li><a href="#more-intepretation-of-the-quantile-regression" id="toc-more-intepretation-of-the-quantile-regression" class="nav-link" data-scroll-target="#more-intepretation-of-the-quantile-regression">More Intepretation of the Quantile Regression</a>
  <ul class="collapse">
  <li><a href="#example-changes-in-the-distribution-properties" id="toc-example-changes-in-the-distribution-properties" class="nav-link" data-scroll-target="#example-changes-in-the-distribution-properties">Example: Changes in the Distribution Properties</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Quantile Regression</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>solar-san </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">December 29, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<p><img src="https://raw.githubusercontent.com/solar-san/BA-Project/main/docs/figures/BA-Project_header.png" class="img-fluid"></p>
<div class="cell">

</div>
<section id="sec-intro" class="level1">
<h1>Introduction</h1>
<blockquote class="blockquote">
<p>What is <em>Business Analytics</em>? It is an applied discipline, tasked with gaining insight into business operations and helping to make better, fact-based decisions: a basic pillar of being <em>data-driven</em>. It combines Statistics, Computer Sciences, Management Science, Operational Research, and much more.</p>
</blockquote>
<p>It has three main components:</p>
<ol type="1">
<li><strong>Descriptive analytics</strong>: providing insight into business questions by summarizing and visualizing observed data. Typically based on simple summaries and charts<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</li>
<li><strong>Predictive analytics</strong>: providing insight into the possible future by extrapolating patterns found in the historical data. Typically making use of statistical or machine learning predictive models (remember the Statistical Learning and Data Analytic courses).</li>
<li><strong>Prescriptive analytics</strong>: providing ways to make the best possible decisions based on the available information.</li>
</ol>
<blockquote class="blockquote">
<p>What is the role of Quantile Regression in Business Analytics?</p>
</blockquote>
<p>The Ordinary-Least-Squares (OLS) based linear regression is a well-known approach when it comes to model relationships between variables, such as:</p>
<p><span id="eq-multlinreg"><span class="math display">
Y_i = \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + ... + \beta_p x_{p i + \epsilon_i}
\tag{1}</span></span></p>
<p>There are fundamental assumptions behind this model:</p>
<ul>
<li>Independence of observations and error terms.</li>
<li>The error terms are identically distributed.</li>
<li>We have <em>homoskedasticity</em> and <em>zero mean</em><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</li>
<li>Normality of errors, as in <span class="math inline">\epsilon \stackrel{iid} {\sim} N(0, \sigma^2_{\epsilon})</span><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</li>
</ul>
<p>The main focus is to estimate the <em>mean</em> of the distribution: all the assumptions lead to the following formula.</p>
<p><span id="eq-condlinreg"><span class="math display">
\mathbb{E} [Y_i \vert X = x_i] = \beta_0 + \beta_1 x_1 + ... + \beta_p x_p
\tag{2}</span></span></p>
<blockquote class="blockquote">
<p>Quantile regression allows to deal with data that cannot be described with a <em>normal distribution</em> and that can be summarised effectively using the <em>mean</em><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
</blockquote>
<p>The main consequence of having homoskedastic and normal errors are:</p>
<ul>
<li>Symmetry.</li>
<li>If the mean and scale are known, we can assume that we know the whole distribution. Therefore, knowing <em>how the mean changes</em> explains <em>all the changes in the distribution</em>.</li>
</ul>
<p>However, this is often not the case.</p>
<blockquote class="blockquote">
<p>This dataset contains information from the 2001 panel of the <em>Survey of Income and Program Participation</em> (SIPP). The dataset contains information on several American households and the household’s annual income in 2001.</p>
</blockquote>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>incomeEx <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pathmaker</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"data/incomeSurvey.csv"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 10111 Columns: 10
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (4): eth, htype, ced, rural
dbl (6): age, ed, hkids, cinc, lcinc, hid

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>incomeEx<span class="sc">$</span>income <span class="ot">&lt;-</span> incomeEx<span class="sc">$</span>cinc<span class="sc">/</span><span class="dv">1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  incomeEx</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      income</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># color = "grey50", </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill  =</span> <span class="st">"grey70"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">yintercept =</span> <span class="fu">seq</span>(</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2000</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="dv">500</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"white"</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Income"</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Income (100s USD)"</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/plotting%20incomex-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="{callout.important}">
<p>Many variables are <em>not</em> symmetric. Moreover, we are often not only interested in the <em>mean</em>, but in understanding <em>extremes</em>. Since the linear regression model cannot give the full description of the distribution and everything is described by its mean, we need an alternative Framework.</p>
</div>
<p>We do not need to forget that linear regression is appropriate for several applications and comes with many practical and theoretical reasons to explain its widespread adoption. For example, it is computationally feasible and easy to implement and can be adapted to handle heteroskedasticity and robustness. Moreover, it can be <em>generalized</em> to handle the non-gaussian case and even non-linearity<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.</p>
</section>
<section id="quantiles" class="level1">
<h1>Quantiles</h1>
<p><em>Quantiles</em> are defined mathematically as:</p>
<p><span id="eq-quantile"><span class="math display">
Q(p) = \mathrm{inf} \{ x: P(X \leq x) \geq p \}
\tag{3}</span></span></p>
<p>This is strictly related to the <em>cumulative distribution function</em>. The quantile of order <span class="math inline">\alpha</span> can also be interpreted as that point in the distribution for which you have a probability <span class="math inline">\alpha</span> of observing a value less than that quantile<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<p>We can compute a set of quantiles to help prove the point. Note that the mean of the distribution is 47.0563867.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pquant <span class="ot">&lt;-</span> <span class="fu">quantile</span>(incomeEx <span class="sc">%&gt;%</span> <span class="fu">pull</span>(income), <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>pquant</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     10%      25%      50%      75%      90% 
11.64731 21.86632 39.18834 63.15703 92.93739 </code></pre>
</div>
</div>
<p>There is a noticeable positive difference between <em>median</em> and <em>mean</em><a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>, indicating a right-skewed distribution. Computing such differences helps in understanding the <em>shape</em> of our distribution.</p>
<p>Moreover, the difference between the 75th and the 50th quantile is larger than the difference between the 50th and the 25th percentile: this is an indication of an <em>asymmetry</em> in the distribution. The same goes when comparing the more extreme tails (e.g.&nbsp;the 10th and 90th quantile):</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Difference between the 75th and 50th and the 50th and 25th quartiles:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>pquant[<span class="dv">4</span>]<span class="sc">-</span> pquant[<span class="dv">3</span>]; pquant[<span class="dv">3</span>] <span class="sc">-</span> pquant[<span class="dv">2</span>]  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     75% 
23.96869 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     50% 
17.32201 </code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Difference between the 90th and 50th and the 50th and 10th quartiles:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>pquant[<span class="dv">5</span>]<span class="sc">-</span> pquant[<span class="dv">3</span>]; pquant[<span class="dv">3</span>] <span class="sc">-</span> pquant[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     90% 
53.74905 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     50% 
27.54102 </code></pre>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Comparing the <em>mean</em> and the <em>median</em> helps in spotting <em>skewness</em>: a <strong>right-skewed</strong> distribution will have a <em>positive</em> difference between them, while a <em>negative</em> difference signals a <strong>left-skewed</strong> distribution. Comparing the difference between quartiles, or between deciles and quartiles, instead, indicates <em>asymmetry</em>: in an <strong>asymmetrical</strong> distribution, these differences will be uneven and wide.</p>
</div>
</div>
<p>Quantiles are not only <em>theoretical</em>: we can build an <em>Empirical Cumulative Distribution Function</em> that describes the cumulative <em>frequencies</em> of the observed values in our data.</p>
<p>For example, for an <span class="math inline">iid</span> sample:</p>
<p><span id="eq-ECDF"><span class="math display">
\hat F = \frac{\mathrm{number \ of \ observations} \leq t}{n}
\tag{4}</span></span></p>
<section id="sample-quantiles-and-sampling-distribution" class="level2">
<h2 class="anchored" data-anchor-id="sample-quantiles-and-sampling-distribution">Sample Quantiles and Sampling Distribution</h2>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we wish to make inferences we need to account for uncertainty.</p>
</div>
</div>
<p>The quantiles can be <em>estimated</em> by inverting the <em>ECDF</em>: this amounts to finding <span class="math inline">Q(p)</span> for a given <span class="math inline">p</span> and, even if the function is <em>discrete</em>, we can extrapolate between the jumps. However, we need to take into account the sampling distribution to make any inference about the characteristics of interest and their distribution shape in the population we are sampling from.</p>
<p>Asymptotic results shows that, for an <em>identically and independently distributed</em> (<span class="math inline">iid</span>) sample, being <span class="math inline">f(x)</span> the <em>probability density function</em> and <span class="math inline">Q(p)</span> the <em>quantile function</em>:</p>
<p><span id="eq-quantileasymptotic"><span class="math display">
\hat Q \stackrel{\mathrm{approx}}{\sim} N \left ( Q(p), \sqrt{\frac{(1- p)p}{n} \frac{1}{f(Q(p))^2}} \right )
\tag{5}</span></span></p>
<p>This function depends on the unknown: probability density function, <span class="math inline">n</span>, and <span class="math inline">p</span>.</p>
</section>
<section id="quantiles-as-a-minimization-problem" class="level2">
<h2 class="anchored" data-anchor-id="quantiles-as-a-minimization-problem">Quantiles as a Minimization Problem</h2>
<p>Quantiles can be considered as a solution to a certain minimization problem; for example, the mean is defined as:</p>
<p><span id="eq-medianargmin"><span class="math display">
x_{0.5} = \underset{c}{\mathrm{argmin}} \ \mathbb{E} [ \ \vert Y - c \vert \ ]
\tag{6}</span></span></p>
<p>A more general formula is:</p>
<p><span id="eq-quantileargmin1"><span class="math display">
Q(p) = \underset{c}{\mathrm{argmin}} \ \mathbb{E} [d_p(Y, c)]
\tag{7}</span></span></p>
<p>Where:</p>
<p><span id="eq-quantileargmin2"><span class="math display">
d_p (Y, c) =
\begin{cases}
\begin{aligned}
(1 -p) \ \vert Y - c \vert \qquad \mathrm{for} \ Y &amp;&lt; c \\
p \ \vert Y - c \vert \qquad \mathrm{for} \ Y &amp;\geq c
\end{aligned}
\end{cases}
\tag{8}</span></span></p>
<p>If we are dealing with <em>sample</em> quantiles instead, we find <span class="math inline">Q(p)</span> as the value that minimises:</p>
<p><span id="eq-quantilesample"><span class="math display">
\frac{1}{n} \sum^n_{i=1} d_p(y_i, c) = \frac{1 - p}{n} \sum_{y_i &lt; q} \ \vert y_i - q \vert + \frac{p}{n} \sum_{y_i &gt; q} \ \vert y_i - q \vert
\tag{9}</span></span></p>
<p>Each point contributes to a certain value and we can represent a <em>loss function</em>.</p>
</section>
<section id="advantages-of-quantiles" class="level2">
<h2 class="anchored" data-anchor-id="advantages-of-quantiles">Advantages of quantiles</h2>
<ul>
<li>The mean, standard deviantion, and skewness are <em>not robust</em>: they are highly sensitive to <em>outliers</em>.</li>
<li>Quantiles are <em>equivariant</em> to non-decreasing transformation.</li>
</ul>
<p>A function is non-decreasing if <span class="math inline">h(b) \geq h(a)</span> if <span class="math inline">b&gt;a</span><a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>. This property implies that <span class="math inline">Q(p, h(Y)) = h(Q(p, Y))</span><a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>.</p>
</section>
<section id="sec-quantilebasedssunivariate" class="level2">
<h2 class="anchored" data-anchor-id="sec-quantilebasedssunivariate">Quantile-based Summary Statistics</h2>
<p>Quantiles allow us to describe the <em>scale</em> and <em>shape</em> of distributions.</p>
<p>Scale can be summarised with a <em>quantile-based scale</em> measure (<strong>QSC</strong>) at a selected <span class="math inline">p</span>:</p>
<p><span id="eq-QSC"><span class="math display">
QSC(p) = Q(1 - p) - Q(p) \ \mathrm{for} \ p &lt; 0.5
\tag{10}</span></span></p>
<p>The <em>interquartile range</em> (IQR) corresponds to QSC(0.25).</p>
<p>Skewness can be summarised with a <em>quantile-based skewness</em> (<strong>QSK</strong>) or <em>asymmetry</em> index:</p>
<p><span id="eq-QSK"><span class="math display">
QSK(p) = \frac{Q(1 - p) - Q(.5)}{Q(.5) - Q(p)} - 1\ \mathrm{for} \ p &lt; 0.5
\tag{11}</span></span></p>
<p>If <span class="math inline">QSK(p) &gt; 0</span>, we have <em>right-skewness</em>.</p>
<section id="computing-the-qsk-and-qsc" class="level3">
<h3 class="anchored" data-anchor-id="computing-the-qsk-and-qsc">Computing the QSK and QSC</h3>
<p>Back at the SIPP example<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>, computing the QSC(.25) and the QSK(.1) will help to determine the scale and shape of the <code>income</code> distribution.</p>
<ul>
<li>QSC(.25):</li>
</ul>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(pquant[<span class="dv">4</span>]<span class="sc">-</span> pquant[<span class="dv">3</span>])<span class="sc">/</span>(pquant[<span class="dv">3</span>] <span class="sc">-</span> pquant[<span class="dv">2</span>]) <span class="sc">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      75% 
0.3837128 </code></pre>
</div>
</div>
<ul>
<li>QSK(.1):</li>
</ul>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(pquant[<span class="dv">5</span>]<span class="sc">-</span> pquant[<span class="dv">3</span>])<span class="sc">/</span>(pquant[<span class="dv">3</span>] <span class="sc">-</span> pquant[<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      90% 
0.9515997 </code></pre>
</div>
</div>
<p>Both these values are <em>positive</em>: this indicates a <em>right-skewed</em> distribution.</p>
</section>
<section id="analysing-known-distributions" class="level3">
<h3 class="anchored" data-anchor-id="analysing-known-distributions">Analysing Known Distributions</h3>
<p>In this second example, we will compare two known distributions that have the <em>same mean</em> but different characteristics, the Gamma and the Normal, sampling values from them.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="dv">100</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">450</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df) <span class="sc">+</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> x, </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">dnorm</span>(</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        x, </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="fl">47.5</span>, </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        <span class="fl">34.2</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"limegreen"</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> x, </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">dgamma</span>(</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        x, </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.9</span>, </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">rate =</span> <span class="fl">0.04</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"#004D73"</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Gamma and Gaussian Densities"</span>,</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(f[x](x))</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>The following code computes the relevant quartiles and deciles:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>pn <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>), <span class="dv">47</span>, <span class="fl">34.2</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>pg <span class="ot">&lt;-</span> <span class="fu">qgamma</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>), <span class="fl">1.9</span>, <span class="at">rate =</span> <span class="fl">0.04</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can immediately confirm that the Normal density is perfectly symmetric<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pn[<span class="dv">4</span>] <span class="sc">-</span> pn[<span class="dv">3</span>]; pn[<span class="dv">3</span>] <span class="sc">-</span> pn[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 23.06755</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 23.06755</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pn[<span class="dv">5</span>] <span class="sc">-</span> pn[<span class="dv">3</span>]; pn[<span class="dv">3</span>] <span class="sc">-</span> pn[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 43.82906</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 43.82906</code></pre>
</div>
</div>
<p>The Gamma density is a whole other story:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>pg[<span class="dv">4</span>] <span class="sc">-</span> pg[<span class="dv">3</span>]; pg[<span class="dv">3</span>] <span class="sc">-</span> pg[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24.68976</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17.26947</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pg[<span class="dv">5</span>] <span class="sc">-</span> pg[<span class="dv">3</span>]; pg[<span class="dv">3</span>] <span class="sc">-</span> pg[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 54.03003</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27.45761</code></pre>
</div>
</div>
<p>Comparing the QSK(0.1) value for the two distributions confirms our result:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>(pn[<span class="dv">5</span>]<span class="sc">-</span>pn[<span class="dv">3</span>])<span class="sc">/</span>(pn[<span class="dv">3</span>]<span class="sc">-</span>pn[<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.110223e-16</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(pg[<span class="dv">5</span>]<span class="sc">-</span>pg[<span class="dv">3</span>])<span class="sc">/</span>(pg[<span class="dv">3</span>]<span class="sc">-</span>pg[<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9677614</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="quantile-regression" class="level1">
<h1>Quantile regression</h1>
<blockquote class="blockquote">
<p>We are modeling the <span class="math inline">\tau</span> quantile of a distribution as a function of the <em>conditional quantile</em> <span class="math inline">X</span>.</p>
</blockquote>
<p>The <em>linear quantile regression</em> model (<strong>QRM</strong>) is:</p>
<p><span id="eq-QRMcond"><span class="math display">
Q_{\tau} (Y \vert X) = \beta_0^{(\tau)} + \beta_1^{(\tau)} X
\tag{12}</span></span></p>
<p>If we assume that <span class="math inline">\epsilon^{(\tau)}</span> is a <em>random variable</em> such that <span class="math inline">Q_{\tau} (\epsilon^{(\tau)} \vert X) = 0</span> we can rewrite the previous equation as:</p>
<p><span id="eq-QRMlin"><span class="math display">
Y = \beta_0^{(\tau)} + \beta_1^{(\tau)} X + \epsilon^{(\tau)}
\tag{13}</span></span></p>
<p>Choosing <span class="math inline">\tau</span> determines the type of QRM: for <span class="math inline">\tau = 0.5</span>, we have a <em>median regression</em>.</p>
<section id="estimation" class="level2">
<h2 class="anchored" data-anchor-id="estimation">Estimation</h2>
<p>If we have pairs of independently sampled observations <span class="math inline">(x_i, y_i)</span>, for <span class="math inline">i = 1, ..., n</span>, the QRM leads to <span class="math inline">y_i = \beta_0^{(\tau)} + \beta_1^{(\tau)} x_i + \epsilon_i^{(\tau)}</span>.</p>
<p>Based on the sampled points, we need a way to fit the function: we need an estimator for <span class="math inline">\beta^{(\tau)} = (\beta_0^{(\tau)}, \beta_1^{(\tau)})</span>.</p>
<p>The median regression model estimates are such as to minimise<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a>:</p>
<p><span id="eq-QRMmedianloss"><span class="math display">
\sum^n_{i = 1} \vert y_i - a - bx_i \vert
\tag{14}</span></span></p>
<p>More generally:</p>
<p><span id="eq-QRMloss1"><span class="math display">
\sum^n_{i = 1} d_{\tau} (y_i, a + b x_i)
\tag{15}</span></span></p>
<p>where:</p>
<p><span id="eq-QRMloss2"><span class="math display">
d_{\tau} (y_i, a + b x_i) =
\begin{cases}
\begin{aligned}
(1 - \tau) \vert y_i - a - bx_i \vert \qquad \mathrm{for} \ y_i &lt; a + b x_i \\
\tau \vert y_i - a - bx_i \vert \qquad \mathrm{for} \ y_i \geq a + b x_i
\end{aligned}
\end{cases}
\tag{16}</span></span></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Minimization is achieved with <em>linear programming</em> methods. The solution <em>might be not unique</em>.</p>
</div>
</div>
</section>
<section id="example-engel-food-expenditure-data" class="level2">
<h2 class="anchored" data-anchor-id="example-engel-food-expenditure-data">Example: Engel Food Expenditure Data</h2>
<p>We will use Engel’s food expenditure data used in Koenker and Bassett(1982). This is a regression dataset consisting of 235 observations on income and expenditure on food for Belgian working-class households.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(engel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plotting the dataset:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> engel, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> income, </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> foodexp</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Engel food expenditure data"</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>We need the <code>quantreg</code> dataset to perform the quantile regression analysis. The function <code>geom_quantile()</code> can be used to compare the standard linear regression fit and the median fit:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> engel, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> income,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> foodexp</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>, </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"limegreen"</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>      ), </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">FALSE</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_quantile</span>(</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fl">0.5</span>, </span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"dodgerblue"</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Engel food expenditure data - mean and median regression"</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">'Regression type:'</span>,</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span><span class="fu">c</span>(</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">'limegreen'</span><span class="ot">=</span><span class="st">'limegreen'</span>,</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dodgerblue'</span><span class="ot">=</span><span class="st">'dodgerblue'</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>      ), </span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Linear Regression'</span>,</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Median Regression'</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
Smoothing formula not specified. Using: y ~ x</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>The following plot represents a set of <em>deciles regressions</em>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> engel, </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> income,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> foodexp</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Engel food expenditure data"</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_quantile</span>(</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">seq</span>(</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>      .<span class="dv">1</span>,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>      .<span class="dv">9</span>,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">by=</span><span class="fl">0.1</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>      ), </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"indianred"</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Smoothing formula not specified. Using: y ~ x</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<blockquote class="blockquote">
<p>With this approach we can see that expenditure on food is <em>not</em> the same in the different quantiles.</p>
</blockquote>
<p>By default <code>geom_quantile</code> shows the quartile fits<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> engel, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> income, </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> foodexp</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Engel food expenditure data"</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_quantile</span>(</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"dodgerblue"</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Smoothing formula not specified. Using: y ~ x</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>We can estimate the QR with the <code>quantreg</code> package, calling the <code>rq</code> function<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>rqfit_engel <span class="ot">&lt;-</span> <span class="fu">rq</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  foodexp <span class="sc">~</span> income, </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> engel</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>rqfit_engel <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call: rq(formula = foodexp ~ income, data = engel)

tau: [1] 0.5

Coefficients:
            coefficients lower bd  upper bd 
(Intercept)  81.48225     53.25915 114.01156
income        0.56018      0.48702   0.60199</code></pre>
</div>
</div>
<p>We will also use the <code>broom</code> library to tidy the model output.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>rqfit_engel <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">conf.low</th>
<th style="text-align: right;">conf.high</th>
<th style="text-align: right;">tau</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">81.4822474</td>
<td style="text-align: right;">47.0904023</td>
<td style="text-align: right;">135.1883939</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">income</td>
<td style="text-align: right;">0.5601806</td>
<td style="text-align: right;">0.4803301</td>
<td style="text-align: right;">0.6127786</td>
<td style="text-align: right;">0.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><code>tidy</code> summarizes information about the components of a model.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>rqfit_engel <span class="sc">%&gt;%</span> <span class="fu">glance</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">tau</th>
<th style="text-align: right;">logLik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">df.residual</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">-1411.63</td>
<td style="text-align: right;">2827.26</td>
<td style="text-align: right;">2834.179</td>
<td style="text-align: right;">233</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><code>glance</code> accepts a model object and returns a <code>tibble::tibble()</code> with exactly one row of model summaries. The summaries are typically goodness of fit measures, p-values for hypothesis tests on residuals, or model convergence information.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>rqfit_engel <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">foodexp</th>
<th style="text-align: right;">income</th>
<th style="text-align: right;">.resid</th>
<th style="text-align: right;">.fitted</th>
<th style="text-align: right;">.tau</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">255.8394</td>
<td style="text-align: right;">420.1577</td>
<td style="text-align: right;">-61.006967</td>
<td style="text-align: right;">316.8464</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">310.9587</td>
<td style="text-align: right;">541.4117</td>
<td style="text-align: right;">-73.811889</td>
<td style="text-align: right;">384.7706</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">485.6800</td>
<td style="text-align: right;">901.1575</td>
<td style="text-align: right;">-100.613114</td>
<td style="text-align: right;">586.2931</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">402.9974</td>
<td style="text-align: right;">639.0802</td>
<td style="text-align: right;">-36.485207</td>
<td style="text-align: right;">439.4826</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">495.5608</td>
<td style="text-align: right;">750.8756</td>
<td style="text-align: right;">-6.547383</td>
<td style="text-align: right;">502.1082</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">633.7978</td>
<td style="text-align: right;">945.7989</td>
<td style="text-align: right;">22.497401</td>
<td style="text-align: right;">611.3004</td>
<td style="text-align: right;">0.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Augment accepts a model object and a dataset and adds information about each observation in the dataset. Most commonly, this includes predicted values in the <code>.fitted</code> column, residuals in the <code>.resid</code> column, and standard errors for the fitted values in a <code>.se.fit</code> column. New columns always begin with a <code>.</code> prefix to avoid overwriting columns in the original dataset.</p>
<p>We could also want to estimate a quantile regression model for several quantiles: this can be done with a unique call using the option <code>tau</code>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>rqmultfit_engel <span class="ot">&lt;-</span> <span class="fu">rq</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  foodexp <span class="sc">~</span> income, </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> engel, </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau =</span> <span class="fu">c</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.1</span>, </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.25</span>, </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.5</span>, </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.75</span>, </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.9</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(rqmultfit_engel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              tau= 0.10  tau= 0.25  tau= 0.50  tau= 0.75  tau= 0.90
(Intercept) 110.1415742 95.4835396 81.4822474 62.3965855 67.3508721
income        0.4017658  0.4741032  0.5601806  0.6440141  0.6862995</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rqmultfit_engel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call: rq(formula = foodexp ~ income, tau = c(0.1, 0.25, 0.5, 0.75, 
    0.9), data = engel)

tau: [1] 0.1

Coefficients:
            coefficients lower bd  upper bd 
(Intercept) 110.14157     79.88753 146.18875
income        0.40177      0.34210   0.45079

Call: rq(formula = foodexp ~ income, tau = c(0.1, 0.25, 0.5, 0.75, 
    0.9), data = engel)

tau: [1] 0.25

Coefficients:
            coefficients lower bd  upper bd 
(Intercept)  95.48354     73.78608 120.09847
income        0.47410      0.42033   0.49433

Call: rq(formula = foodexp ~ income, tau = c(0.1, 0.25, 0.5, 0.75, 
    0.9), data = engel)

tau: [1] 0.5

Coefficients:
            coefficients lower bd  upper bd 
(Intercept)  81.48225     53.25915 114.01156
income        0.56018      0.48702   0.60199

Call: rq(formula = foodexp ~ income, tau = c(0.1, 0.25, 0.5, 0.75, 
    0.9), data = engel)

tau: [1] 0.75

Coefficients:
            coefficients lower bd  upper bd 
(Intercept)  62.39659     32.74488 107.31362
income        0.64401      0.58016   0.69041

Call: rq(formula = foodexp ~ income, tau = c(0.1, 0.25, 0.5, 0.75, 
    0.9), data = engel)

tau: [1] 0.9

Coefficients:
            coefficients lower bd  upper bd 
(Intercept)  67.35087     37.11802 103.17399
income        0.68630      0.64937   0.74223</code></pre>
</div>
</div>
<p>To plot these different models:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>aug1 <span class="ot">&lt;-</span> rqmultfit_engel <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>()</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(aug1) <span class="sc">+</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> income,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> foodexp</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"gray40"</span>,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> engel</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> income, </span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span>.fitted, </span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> .tau</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"div"</span>,</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"Dark2"</span>,</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">aesthetics =</span> <span class="st">"colour"</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>We could also plot the slope estimate as a function of <span class="math inline">\tau</span>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>rqmultfit_engel <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    term <span class="sc">==</span> <span class="st">"income"</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    tau, </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    estimate</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> tau, </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> estimate</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Slope Estimate as a Function of the Quantile"</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Note that the usual <code>R</code> methods are available, such as <code>predict</code> (to derive predicted values) and <code>residuals</code> (to compute the residuals).</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>rqmultfit_engel <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]     [,2]     [,3]     [,4]     [,5]
[1,] 278.9465 294.6816 316.8464 332.9841 355.7048
[2,] 327.6623 352.1686 384.7706 411.0734 438.9214
[3,] 472.1958 522.7252 586.2931 642.7547 685.8148
[4,] 366.9021 398.4735 439.4826 473.9733 505.9513
[5,] 411.8177 451.4761 502.1082 545.9711 582.6764
[6,] 490.1312 543.8898 611.3004 671.5045 716.4522</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>rqmultfit_engel <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     tau= 0.10  tau= 0.25   tau= 0.50  tau= 0.75  tau= 0.90
[1,] -23.10711 -38.842205  -61.006967  -77.14463  -99.86542
[2,] -16.70359 -41.209900  -73.811889 -100.11471 -127.96278
[3,]  13.48423 -37.045167 -100.613114 -157.07472 -200.13475
[4,]  36.09523   4.523829  -36.485207  -70.97593 -102.95395
[5,]  83.74309  44.084702   -6.547383  -50.41032  -87.11564
[6,] 143.66662  89.907968   22.497401  -37.70665  -82.65437</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>rqmultfit_engel <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> income, </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> .resid</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey80"</span>,</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>.tau,</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">3</span>,</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Residual Plot for Different Quantiles"</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
<section id="interpreting-the-slope-difference" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-the-slope-difference">Interpreting the Slope Difference</h2>
<blockquote class="blockquote">
<p>What are the implications of different <span class="math inline">\beta_1^{(\tau)}</span> slopes?</p>
</blockquote>
<p>If we take two models for <span class="math inline">\tau = p</span> and <span class="math inline">\tau = q</span> and rearrange the two equations, having the same data points <span class="math inline">(y_i, x_i)</span>, we obtain:</p>
<p><span id="eq-slopedifferences1"><span class="math display">
(\epsilon_i^{(p)} - \epsilon_i^{(q)}) = (\beta_0^{(p)} - \beta_0^{(q)}) + (\beta_1^{(p)} - \beta_1^{(q)})x_i
\tag{17}</span></span></p>
<p>The difference between the two errors depends on <span class="math inline">x_i</span>. If the two slopes are equal<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a>, then the two errors differ only by a constant: hence, the quantile error distribution only differs for a constant. This means that the observations are identically distributed for different values of <span class="math inline">X</span>.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>QRM can be used to assess whether the assumption of <em>identically distributed</em> observations is valid.</p>
</div>
</div>
<p>Note that, however, to formally test the equality of slopes we need a way to make <em>inference</em><a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a>: if that was the case we would be in a situation in which we have the <em>same shape</em> for the distribution conditional on the different values of the predictor<a href="#fn17" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a>. In other words, we need inference because we are interested in testing:</p>
<p><span class="math display">
\begin{cases}
\begin{aligned}
H_0: \beta_1^{(\tau_1)} = … = \beta_1^{(\tau_q)} \\
H_1: \beta_1^{(\tau_1)} \neq … \neq \beta_1^{(\tau_q)}
\end{aligned}
\end{cases}
</span></p>
<p>To carry out this test we can use <code>anova</code> on a <code>rqs</code> object:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(rqmultfit_engel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Quantile Regression Analysis of Deviance Table

Model: foodexp ~ income
Joint Test of Equality of Slopes: tau in {  0.1 0.25 0.5 0.75 0.9  }

  Df Resid Df F value    Pr(&gt;F)    
1  4     1171  11.466 3.927e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We can see in this case we confidently reject the null hypothesis: the slopes are quite different and we would be inclined to consider that the conditional distribution of <code>foodexp</code> changes at different levels of <code>income</code>.</p>
</section>
<section id="multiple-independent-variables" class="level2">
<h2 class="anchored" data-anchor-id="multiple-independent-variables">Multiple Independent variables</h2>
<p>We can extend the model and obtain a <em>multivariate</em> quantile regression. In the (compact) matrix notation we have:</p>
<p><span id="eq-multiQRM"><span class="math display">
Q_{\tau} = (Y \vert \mathbf{X}) = \mathbf{X} \mathbf{\beta}^{(\tau)} + \epsilon_i^{\tau}
\tag{18}</span></span></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The coefficients <span class="math inline">\mathbf{\beta}^{(\tau)}</span> can be interpreted as the effect of <span class="math inline">x</span> on the quantile once the effect of other variables is also taken into account.</p>
</div>
</div>
<p>Again, we need a way to assess the significance of each added variable: in other words, a way to make <em>inference</em><a href="#fn18" class="footnote-ref" id="fnref18" role="doc-noteref"><sup>18</sup></a>.</p>
<section id="example-munich-rent-data" class="level3">
<h3 class="anchored" data-anchor-id="example-munich-rent-data">Example: Munich Rent data</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>rents <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_table</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pathmaker</span>(</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/rent99.raw"</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent =</span> <span class="fu">col_double</span>(),</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">rentsqm =</span> <span class="fu">col_double</span>(),</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">area =</span> <span class="fu">col_double</span>(),</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">yearc =</span> <span class="fu">col_double</span>(),</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="fu">col_factor</span>(),</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">bath =</span> <span class="fu">col_factor</span>(),</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">kitchen =</span> <span class="fu">col_factor</span>(),</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">cheating =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">district =</span> <span class="fu">col_factor</span>()</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>rents <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  str</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [3,082 × 9] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ rent    : num [1:3082] 121 437 356 283 807 ...
 $ rentsqm : num [1:3082] 3.46 4.2 12.27 7.25 8.32 ...
 $ area    : num [1:3082] 35 104 29 39 97 62 31 61 72 75 ...
 $ yearc   : num [1:3082] 1939 1939 1971 1972 1985 ...
 $ location: Factor w/ 3 levels "1","2","3": 1 1 2 2 1 1 1 2 1 1 ...
 $ bath    : Factor w/ 2 levels "0","1": 1 2 1 1 1 1 1 2 1 1 ...
 $ kitchen : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ cheating: logi [1:3082] FALSE TRUE TRUE TRUE TRUE TRUE ...
 $ district: Factor w/ 336 levels "1112","2114",..: 1 1 2 3 4 4 5 6 7 6 ...
 - attr(*, "spec")=
  .. cols(
  ..   rent = col_double(),
  ..   rentsqm = col_double(),
  ..   area = col_double(),
  ..   yearc = col_double(),
  ..   location = col_factor(levels = NULL, ordered = FALSE, include_na = FALSE),
  ..   bath = col_factor(levels = NULL, ordered = FALSE, include_na = FALSE),
  ..   kitchen = col_factor(levels = NULL, ordered = FALSE, include_na = FALSE),
  ..   cheating = col_logical(),
  ..   district = col_factor(levels = NULL, ordered = FALSE, include_na = FALSE)
  .. )</code></pre>
</div>
</div>
<p>To begin, we will set <code>area</code> and <code>yearc</code> as predictors:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  rents</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>      area, </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>      rent</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">7</span>,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"grey20"</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent by Area"</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  rents</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>      yearc, </span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>      rent</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">7</span>,</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"grey20"</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent by Construction Year"</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>We will fit a multivariate quantile regression with both variables:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>rqfitmunich <span class="ot">&lt;-</span> <span class="fu">rq</span>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  rent <span class="sc">~</span> area <span class="sc">+</span> yearc,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> rents, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau =</span> <span class="fu">c</span>(</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.1</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">5</span>,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">9</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>rqfitmunich <span class="sc">%&gt;%</span> </span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">conf.low</th>
<th style="text-align: right;">conf.high</th>
<th style="text-align: right;">tau</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-5058.803296</td>
<td style="text-align: right;">-6045.515190</td>
<td style="text-align: right;">-4153.225808</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">area</td>
<td style="text-align: right;">3.055598</td>
<td style="text-align: right;">2.688700</td>
<td style="text-align: right;">3.403946</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">yearc</td>
<td style="text-align: right;">2.630504</td>
<td style="text-align: right;">2.165352</td>
<td style="text-align: right;">3.072749</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-5799.917928</td>
<td style="text-align: right;">-6245.829978</td>
<td style="text-align: right;">-5080.578581</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">area</td>
<td style="text-align: right;">4.976878</td>
<td style="text-align: right;">4.711466</td>
<td style="text-align: right;">5.250883</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">yearc</td>
<td style="text-align: right;">3.020311</td>
<td style="text-align: right;">2.678046</td>
<td style="text-align: right;">3.244704</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-3006.253746</td>
<td style="text-align: right;">-3523.283675</td>
<td style="text-align: right;">-2615.828128</td>
<td style="text-align: right;">0.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">area</td>
<td style="text-align: right;">8.175314</td>
<td style="text-align: right;">7.823535</td>
<td style="text-align: right;">8.577421</td>
<td style="text-align: right;">0.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">yearc</td>
<td style="text-align: right;">1.587616</td>
<td style="text-align: right;">1.391114</td>
<td style="text-align: right;">1.845884</td>
<td style="text-align: right;">0.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> rqfitmunich <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">area =</span> <span class="fu">seq</span>(</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">160</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>        ), </span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">yearc =</span> <span class="dv">1990</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rents, </span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>      area, </span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>      rent</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">7</span>,</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span><span class="st">"grey80"</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>      area, </span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>      .fitted, </span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span>.tau</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"div"</span>,</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"Dark2"</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Multivariate Quantile Regression: Rents by Area </span><span class="sc">\n</span><span class="st"> for different Deciles"</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> rqfitmunich <span class="sc">%&gt;%</span> </span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">area =</span> <span class="dv">80</span>, </span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">yearc =</span> <span class="fu">seq</span>(</span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1918</span>,</span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1997</span></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rents, </span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a>      yearc, </span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a>      rent</span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span><span class="st">"grey"</span></span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true" tabindex="-1"></a>      yearc, </span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true" tabindex="-1"></a>      .fitted, </span>
<span id="cb68-58"><a href="#cb68-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span>.tau</span>
<span id="cb68-59"><a href="#cb68-59" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb68-60"><a href="#cb68-60" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb68-61"><a href="#cb68-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(</span>
<span id="cb68-62"><a href="#cb68-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"div"</span>,</span>
<span id="cb68-63"><a href="#cb68-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"Dark2"</span></span>
<span id="cb68-64"><a href="#cb68-64" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-65"><a href="#cb68-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb68-66"><a href="#cb68-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Multivariate Quantile Regression: Rents by Year </span><span class="sc">\n</span><span class="st"> for different Deciles"</span></span>
<span id="cb68-67"><a href="#cb68-67" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb68-68"><a href="#cb68-68" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>We should always take a look at the residuals:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>rqfitmunich <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span>  </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>      yearc, </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>      .resid</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"grey60"</span>,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rows =</span> <span class="fu">vars</span>(.tau)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
<section id="sec-inference" class="level2">
<h2 class="anchored" data-anchor-id="sec-inference">Inference</h2>
<section id="iid-case" class="level3">
<h3 class="anchored" data-anchor-id="iid-case"><span class="math inline">iid</span> case</h3>
<blockquote class="blockquote">
<p>Does the addition of a variable <span class="math inline">x_j</span> <em>improve</em> the goodness of fit?</p>
</blockquote>
<p>There are two approaches to conducting inference in the context of quantile regression:</p>
<ol type="1">
<li>With lots of mathematics we can derive some asymptotic results for <span class="math inline">\beta^{(\tau)}</span>.</li>
<li>Another option is to use <em>simulation based inference</em>, such as <strong>the bootstrap</strong>.</li>
</ol>
<p>For <span class="math inline">iid</span> observations it can be shown that, under some weak conditions:</p>
<p><span id="eq-inference"><span class="math display">
\sqrt{n} (\hat \beta - \beta) \stackrel{d} {\to} N( 0, \mathbf{\Sigma})
\tag{19}</span></span></p>
<p><span class="math inline">\mathbf{\Sigma}</span> is the <em>variance-covariance</em> matrix of form:</p>
<p><span id="eq-inferencevarcovarmatrix"><span class="math display">
\mathbf{\Sigma} = \frac{\tau(1 - \tau)}{f_{\epsilon (\tau)}} (\mathbf{X}^T \mathbf{X})^{-1}
\tag{20}</span></span></p>
<p>The term <span class="math inline">f_{\epsilon (\tau)}</span> is the <em>pdf</em> of the error term <span class="math inline">\epsilon (\tau)</span> evaluated at the <span class="math inline">\tau^{th}</span> quantile of the error distribution, which we assumed to be 0.</p>
</section>
<section id="non-iid-case" class="level3">
<h3 class="anchored" data-anchor-id="non-iid-case">Non-<span class="math inline">iid</span> case</h3>
<p>The form of <span class="math inline">\mathbf{\Sigma}</span> for the non-identically distributed case is fairly complex.</p>
<p>In general, the required mathematics is difficult and it is not always possible to derive asymptotic variances analytically. Hence, a simulation-based method such as the <strong>bootstrap</strong> is required.</p>
</section>
</section>
<section id="the-bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="the-bootstrap">The Bootstrap</h2>
<blockquote class="blockquote">
<p><strong>Bootstrapping</strong><a href="#fn19" class="footnote-ref" id="fnref19" role="doc-noteref"><sup>19</sup></a> is <em>any test or metric that uses random sampling with replacement</em>, mimicking the sampling process, and falls under the broader class of <em>resampling methods</em>. Bootstrapping assigns <em>measures of accuracy</em><a href="#fn20" class="footnote-ref" id="fnref20" role="doc-noteref"><sup>20</sup></a> to sample estimates. This technique allows the estimation of the sampling distribution of almost any statistic using random sampling methods.</p>
</blockquote>
<p>It is based on the sample data and having <em>enough</em> computing power. The key idea is that we assume the population is just many copies of the sample; then, we make lots of copies of the sample and then we sample repeatedly from the population. In practice, instead of making many copies of the sample and sampling from that, we use a sampling technique that is equivalent, based on <em>sampling with replacement</em>.</p>
<p>In particular, we will use <strong>nonparametric resampling bootstrap</strong>.</p>
<ul>
<li>We sample <em>with replacement</em> from the original sample.</li>
<li>Each sample selected is called a <em>bootstrap sample</em>.</li>
<li>For each bootstrap sample, we compute the estimate of the parameter, giving us a <em>bootstrap estimate</em>.</li>
<li>We collect the bootstrap estimates for many bootstrap samples to create a <em>bootstrap distribution</em> which we use as a <em>sampling distribution</em> for the estimate.</li>
</ul>
<section id="bootstrap-confidence-intervals" class="level3">
<h3 class="anchored" data-anchor-id="bootstrap-confidence-intervals">Bootstrap Confidence Intervals</h3>
<p>We can construct confidence intervals by bootstrap.</p>
<blockquote class="blockquote">
<p>When a bootstrap distribution for an estimate is <strong>symmetric</strong> and <strong>bell-shaped</strong>, we calculate a <span class="math inline">1 − \alpha</span>% confidence interval using:</p>
</blockquote>
<p><span id="eq-CIsymmetricbootstrap"><span class="math display">
\left [\hat \theta - q_{1- \frac{\alpha}{2}} \times \mathrm{sd_{boot}},
\hat \theta + q_{1- \frac{\alpha}{2}} \times \mathrm{sd_{boot}} \right ]
\tag{21}</span></span></p>
<p>where <span class="math inline">\mathrm{sd_{boot}}</span> denotes the standard deviation of the bootstrap estimates.</p>
<blockquote class="blockquote">
<p>When a bootstrap distribution for an estimate is <strong><em>not</em> symmetric</strong> we calculate a <span class="math inline">1 − \alpha</span>% confidence interval using:</p>
</blockquote>
<p><span id="eq-CIasymmetricbootstrap"><span class="math display">
\left [\theta_{\mathrm{boot}} \left (\frac{\alpha}{2} \right),
\theta_{\mathrm{boot}}\left (1 - \frac{\alpha}{2} \right) \right]
\tag{22}</span></span></p>
<p>These two extremes denote the <span class="math inline">\alpha/2</span> and <span class="math inline">1 - \alpha/2</span> <em>empirical quantiles</em> of the bootstrap estimates.</p>
</section>
<section id="bootstrap-inference" class="level3">
<h3 class="anchored" data-anchor-id="bootstrap-inference">Bootstrap Inference</h3>
<p>Using the <em>standard error</em> derived with the bootstrap samples we can build a test on <span class="math inline">\beta_j^{\tau}</span><a href="#fn21" class="footnote-ref" id="fnref21" role="doc-noteref"><sup>21</sup></a>, in the form</p>
<p><span id="eq-bootstrapinference"><span class="math display">
\begin{cases}
\begin{aligned}
H_0: B_j = 0 \\
H_1 : B_j \neq 0
\end{aligned}
\end{cases}
\tag{23}</span></span></p>
<p>Under the null hypothesis, our null statistic is:</p>
<p><span id="eq-teststatistic"><span class="math display">
TS_{B_j} = \frac{\hat \beta_j}{se(B_j)} \sim N(0, 1)
\tag{24}</span></span></p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>We estimate <span class="math inline">se(\beta_j)</span> with the bootstrap or with some theoretical derivation: hence, we need to compare the test statistic against a <span class="math inline">T</span> distribution with <span class="math inline">n − (p + 1)</span> degrees of freedom.</p>
</div>
</div>
<p>Inference on a single coefficient is often useful; however, we wish to test other hypotheses and also a to test <em>set</em> of hypotheses.</p>
<p>For a QR model for a single quantile <span class="math inline">\tau</span> we can have two different <em>nested model</em> structures; for <span class="math inline">q \geq p</span>:</p>
<p><span id="eq-nestedmodels"><span class="math display">
\begin{aligned}
\mathrm{Model \ 0}: \qquad Q_{\tau} (Y \vert X_1, …, X_q) = \beta_0^{\tau} + \beta_1^{\tau} X_1 + … + \beta_q^{\tau} \\
\mathrm{Model \ 1}: \qquad Q_{\tau} (Y \vert X_1, …, X_p) = \beta_0^{\tau} + \beta_1^{\tau} X_1 + … + \beta_p^{\tau} \\
\end{aligned}
\tag{25}</span></span></p>
<p>Note that <em>Model 1</em> reduces to <em>Model 2</em> when <span class="math inline">\beta_{p + 1} = … = \beta_q = 0</span>.</p>
<p>We are interested in constructing a test to verify the following null hypothesis<a href="#fn22" class="footnote-ref" id="fnref22" role="doc-noteref"><sup>22</sup></a>:</p>
<p><span id="eq-nestedinference"><span class="math display">
\begin{cases}
\begin{aligned}
H_0: B_{p + 1} = … = \beta_q = 0 \\
H_1: B_{p + 1} = … = \beta_q \neq 0
\end{aligned}
\end{cases}
\tag{26}</span></span></p>
<p>This null hypothesis can be tested through an ANOVA test, based on the asymptotic <em>normality</em>.</p>
<p>Another important test might involve the comparison of the slopes of <span class="math inline">\beta^{(p)}_1</span> and <span class="math inline">\beta^{(q)}_1</span>, under the assumption of <em>identically distributed</em> data. In this case, we are comparing models for <em>different quantiles</em>; if we have one explanatory variable, then:</p>
<p><span id="eq-slopecomparison"><span class="math display">
\begin{aligned}
\mathrm{Model \ 1}: Q_{q} (Y \vert X) = \beta_0^{(q)} + \beta_1^{(q)} X \\
\mathrm{Model \ 2}: Q_{p} (Y \vert X) = \beta_0^{(p)} + \beta_1^{(p)} X
\end{aligned}
\tag{27}</span></span></p>
<p>We are interested in the following hypothesis:</p>
<p><span id="eq-slopetest"><span class="math display">
\begin{cases}
\begin{aligned}
H_0: B^{(p)}_1 = B^{(q)}_1 \\
H_1: B^{(p)}_1 \neq B^{(q)}_1
\end{aligned}
\end{cases}
\tag{28}</span></span></p>
<p>Again, this test can be performed via ANOVA, based on the asymptotic normality.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>we should test for <em>more</em> than two quantiles; formal testing gives <em>evidence</em> of varying slopes.</p>
</div>
</div>
</section>
<section id="example-bootstrap" class="level3">
<h3 class="anchored" data-anchor-id="example-bootstrap">Example: Bootstrap</h3>
<blockquote class="blockquote">
<p>This first application of the bootstrap is characterized by a situation in which a well-established theory exists to quantify the variability of our estimation: <em>the estimation of the mean</em>.</p>
</blockquote>
<p>We will keep using the Munich rent dataset restrict ourselves to the houses with <em>premium kitchens</em>, and focus on variables <code>area</code> and <code>rentsqm</code>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>rents_kp <span class="ot">&lt;-</span> rents[rents<span class="sc">$</span>kitchen <span class="sc">==</span><span class="dv">1</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> rents_kp</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>      area</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"gray40"</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> rents_kp</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>      rentsqm</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"gray40"</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>We can compute the mean for each of the variables and compute confidence intervals based on the Central Limit Theorem approximation for the mean:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>rents_kp <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_area =</span> <span class="fu">mean</span>(area),</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">se_area =</span> <span class="fu">sd</span>(area)<span class="sc">/</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(area))),</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_rentsqm =</span> <span class="fu">mean</span>(rentsqm),</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">se_rentsqm =</span> <span class="fu">sd</span>(rentsqm)<span class="sc">/</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(rentsqm)))</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">mean_area</th>
<th style="text-align: right;">se_area</th>
<th style="text-align: right;">mean_rentsqm</th>
<th style="text-align: right;">se_rentsqm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">72.14504</td>
<td style="text-align: right;">1.863899</td>
<td style="text-align: right;">8.538188</td>
<td style="text-align: right;">0.190618</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>rents_kp <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CLT_CI_area =</span> <span class="fu">mean</span>(area) <span class="sc">+</span> <span class="fu">qt</span>(<span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>), <span class="fu">nrow</span>(rents_kp)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="fu">sd</span>(area)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">nrow</span>(rents_kp)),</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">CLT_CI_rentsqm =</span> <span class="fu">mean</span>(rentsqm) <span class="sc">+</span> <span class="fu">qt</span>(<span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>), <span class="fu">nrow</span>(rents_kp)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="fu">sd</span>(rentsqm)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">nrow</span>(rents_kp))</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">CLT_CI_area</th>
<th style="text-align: right;">CLT_CI_rentsqm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">68.45754</td>
<td style="text-align: right;">8.161073</td>
</tr>
<tr class="even">
<td style="text-align: right;">75.83254</td>
<td style="text-align: right;">8.915302</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can create our bootstrapped sample with the following code:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">19</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>boot1 <span class="ot">&lt;-</span> rents_kp <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    area</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fu">length</span>(.),</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The mean and standard deviation of our bootstrapped sample are:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">area =</span>  boot1</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_area =</span> <span class="fu">mean</span>(area),</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">se_area =</span> <span class="fu">sd</span>(area)<span class="sc">/</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(area)))</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">mean_area</th>
<th style="text-align: right;">se_area</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">71.28244</td>
<td style="text-align: right;">1.63154</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can iterate the procedure to obtain a <em>distribution</em> of means:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>nboot <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>boots <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">length =</span> nboot)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nboot){</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  booti <span class="ot">&lt;-</span> rents_kp <span class="sc">%&gt;%</span> <span class="fu">pull</span>(area) <span class="sc">%&gt;%</span> <span class="fu">sample</span>(<span class="at">size =</span> <span class="fu">length</span>(.), </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  boots[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(booti)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> boots</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey40"</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> <span class="fu">mean</span>(boots),</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">'limegreen'</span>,</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> T</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> <span class="fu">mean</span>(</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>      rents_kp<span class="sc">$</span>area,</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">'royalblue3'</span>,</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">show.legend =</span> T</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Bootstrapped distribution for the mean Area"</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Moreover, we can compute <em>bootstrapped confidence intervals</em>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">area =</span>  boot1</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrapped_CI =</span> <span class="fu">mean</span>(rents_kp<span class="sc">$</span>area) <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fu">c</span>(.<span class="dv">04</span>, .<span class="dv">96</span>)) <span class="sc">*</span> <span class="fu">sd</span>(boots)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">bootstrapped_CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">68.89321</td>
</tr>
<tr class="even">
<td style="text-align: right;">75.39687</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="example-bootstrap-for-quantile-regression" class="level3">
<h3 class="anchored" data-anchor-id="example-bootstrap-for-quantile-regression">Example: Bootstrap for Quantile Regression</h3>
<p>To compute <em>bootstrapped standard errors</em>, based on resampling, we need to pass the argument <code>se = "boot"</code> to the <code>summary</code> function. <code>R</code> specifies the number of bootstrap replications.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">19</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>rent_median <span class="ot">&lt;-</span> <span class="fu">rq</span>(</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  rent <span class="sc">~</span> area, </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> rents_kp</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rq.fit.br(x, y, tau = tau, ...): Solution may be nonunique</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  rent_median, </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">se =</span> <span class="st">"boot"</span>, </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="dv">1201</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call: rq(formula = rent ~ area, data = rents_kp)

tau: [1] 0.5

Coefficients:
            Value    Std. Error t value  Pr(&gt;|t|)
(Intercept) -8.10519 47.29873   -0.17136  0.86421
area         9.06923  0.74394   12.19082  0.00000</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  rents_kp, </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    area, </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    rent</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"grey40"</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_quantile</span>(</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles  =</span> <span class="fl">0.5</span>, </span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"limegreen"</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Smoothing formula not specified. Using: y ~ x</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rq.fit.br(wx, wy, tau = tau, ...): Solution may be nonunique</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>The following code computes the bootstrapped confidence intervals and standard errors <em>stepwise</em>: this will help in understanding the logic behind this resampling method.</p>
<ol type="1">
<li>We need to initialize an empty matrix in which we will store the bootstrapped <em>intercept</em> and <em>slope</em> values.</li>
</ol>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">19</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>nboot <span class="ot">&lt;-</span> <span class="dv">5201</span> </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>boots <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>, </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> nboot, </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Then, we can loop the sampling procedure and store the fitted coefficients in the initialized array.</li>
</ol>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nboot){</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  tdat <span class="ot">&lt;-</span> rents_kp[</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">seq</span>(</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">nrow</span>(</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>          rents_kp</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>        ), </span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">replace =</span> <span class="cn">TRUE</span>, </span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="fu">nrow</span>(</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>        rents_kp</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>      ), ]</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>  trqfit <span class="ot">&lt;-</span> <span class="fu">rq</span>(</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>    rent <span class="sc">~</span> area, </span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> tdat</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>  tcoef <span class="ot">&lt;-</span> <span class="fu">coef</span>(trqfit)</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>  boots[j, ] <span class="ot">&lt;-</span> tcoef</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(boots) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Intercept"</span>,<span class="st">"Slope"</span>)</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>boots <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(boots)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>To conclude, we can compute the bootstrapped summary statistics.</li>
</ol>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>boots <span class="sc">%&gt;%</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_int =</span> <span class="fu">mean</span>(Intercept), </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">se_int =</span> <span class="fu">sd</span>(Intercept),</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_slope =</span> <span class="fu">mean</span>(Slope), </span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">se_slope =</span> <span class="fu">sd</span>(Slope),</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower_slope =</span> <span class="fu">coef</span>(rent_median)[<span class="dv">2</span>]<span class="sc">+</span><span class="fu">qt</span>(.<span class="dv">02</span>, <span class="at">df=</span><span class="dv">129</span>) <span class="sc">*</span> se_slope,</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper_slope =</span> <span class="fu">coef</span>(rent_median)[<span class="dv">2</span>]<span class="sc">+</span><span class="fu">qt</span>(.<span class="dv">98</span>, <span class="at">df=</span><span class="dv">129</span>) <span class="sc">*</span> se_slope</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">mean_int</th>
<th style="text-align: right;">se_int</th>
<th style="text-align: right;">mean_slope</th>
<th style="text-align: right;">se_slope</th>
<th style="text-align: right;">lower_slope</th>
<th style="text-align: right;">upper_slope</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-9.315754</td>
<td style="text-align: right;">47.57302</td>
<td style="text-align: right;">9.033454</td>
<td style="text-align: right;">0.744816</td>
<td style="text-align: right;">7.523945</td>
<td style="text-align: right;">10.61452</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(boots) <span class="sc">+</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>      Slope</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"gray40"</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Slopes Distribution"</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(boots) <span class="sc">+</span> </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>      Intercept</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"gray40"</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Intercepts Distribution"</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2 <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Bootstrapped Coefficients"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
<section id="example-inference-bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="example-inference-bootstrap">Example: Inference &amp; Bootstrap</h2>
<p>We will compare different models; they will <em>polynomial</em> variations of the same regression.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>rqfit2munich <span class="ot">&lt;-</span> <span class="fu">rq</span>(</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  rent <span class="sc">~</span> area <span class="sc">+</span> yearc <span class="sc">+</span> <span class="fu">I</span>(area<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(yearc<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> rents, </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau =</span> <span class="fu">c</span>(</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.1</span>, </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.25</span>, </span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">5</span>, </span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">75</span>, </span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">9</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>  rqfit2munich, </span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">se=</span><span class="st">"boot"</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call: rq(formula = rent ~ area + yearc + I(area^2) + I(yearc^2), tau = c(0.1, 
    0.25, 0.5, 0.75, 0.9), data = rents)

tau: [1] 0.1

Coefficients:
            Value       Std. Error  t value     Pr(&gt;|t|)   
(Intercept) 85494.66597 30991.81335     2.75862     0.00584
area            2.25021     0.73171     3.07528     0.00212
yearc         -90.05313    31.77195    -2.83436     0.00462
I(area^2)       0.00501     0.00586     0.85411     0.39311
I(yearc^2)      0.02372     0.00814     2.91329     0.00360

Call: rq(formula = rent ~ area + yearc + I(area^2) + I(yearc^2), tau = c(0.1, 
    0.25, 0.5, 0.75, 0.9), data = rents)

tau: [1] 0.25

Coefficients:
            Value        Std. Error   t value      Pr(&gt;|t|)    
(Intercept) 140289.03522  23986.32785      5.84871      0.00000
area             3.89787      0.48385      8.05590      0.00000
yearc         -146.49186     24.61127     -5.95223      0.00000
I(area^2)       -0.00143      0.00351     -0.40813      0.68321
I(yearc^2)       0.03825      0.00631      6.05924      0.00000

Call: rq(formula = rent ~ area + yearc + I(area^2) + I(yearc^2), tau = c(0.1, 
    0.25, 0.5, 0.75, 0.9), data = rents)

tau: [1] 0.5

Coefficients:
            Value        Std. Error   t value      Pr(&gt;|t|)    
(Intercept) 254129.26393  29245.84364      8.68941      0.00000
area             3.97520      0.63765      6.23413      0.00000
yearc         -263.02511     29.89133     -8.79938      0.00000
I(area^2)        0.00537      0.00513      1.04764      0.29489
I(yearc^2)       0.06808      0.00764      8.91247      0.00000

Call: rq(formula = rent ~ area + yearc + I(area^2) + I(yearc^2), tau = c(0.1, 
    0.25, 0.5, 0.75, 0.9), data = rents)

tau: [1] 0.75

Coefficients:
            Value        Std. Error   t value      Pr(&gt;|t|)    
(Intercept) 276975.85622  34282.00338      8.07934      0.00000
area             4.77638      0.83885      5.69398      0.00000
yearc         -285.38020     35.04969     -8.14216      0.00000
I(area^2)        0.01012      0.00673      1.50444      0.13257
I(yearc^2)       0.07354      0.00896      8.20853      0.00000

Call: rq(formula = rent ~ area + yearc + I(area^2) + I(yearc^2), tau = c(0.1, 
    0.25, 0.5, 0.75, 0.9), data = rents)

tau: [1] 0.9

Coefficients:
            Value        Std. Error   t value      Pr(&gt;|t|)    
(Intercept) 283939.08515  35821.24027      7.92656      0.00000
area             5.34324      0.76391      6.99458      0.00000
yearc         -292.08831     36.59855     -7.98087      0.00000
I(area^2)        0.01746      0.00631      2.76816      0.00567
I(yearc^2)       0.07516      0.00935      8.03951      0.00000</code></pre>
</div>
</div>
<p>The option <code>se = "boot"</code> computes the standard errors using the <em>bootstrap</em>. To compare the fitness of available models, we can use the ANOVA test:</p>
<p>The <code>se="boot"</code> option will compute the standard error estimates using the bootstrap.</p>
<p>To compare the different models, we can use the ANOVA test:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rq</span>(</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    rent <span class="sc">~</span> area <span class="sc">+</span> yearc <span class="sc">+</span> <span class="fu">I</span>(area<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(yearc<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rents,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau =</span> <span class="fu">c</span>(</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.1</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rq</span>(</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>    rent <span class="sc">~</span> area <span class="sc">+</span> yearc <span class="sc">+</span> <span class="fu">I</span>(yearc<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rents, </span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau =</span> <span class="fu">c</span>(</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.1</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Quantile Regression Analysis of Deviance Table

Model 1: rent ~ area + yearc + I(area^2) + I(yearc^2)
Model 2: rent ~ area + yearc + I(yearc^2)
  Df Resid Df F value Pr(&gt;F)
1  1     3077  1.3754  0.241</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rq</span>(</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    rent <span class="sc">~</span> area <span class="sc">+</span> yearc <span class="sc">+</span><span class="fu">I</span>(area<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(yearc<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rents, </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau =</span> <span class="fu">c</span>(</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.9</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rq</span>(</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>    rent <span class="sc">~</span> area <span class="sc">+</span> yearc,</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rents, </span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau =</span> <span class="fu">c</span>(</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.9</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Quantile Regression Analysis of Deviance Table

Model 1: rent ~ area + yearc + I(area^2) + I(yearc^2)
Model 2: rent ~ area + yearc
  Df Resid Df F value    Pr(&gt;F)    
1  2     3077  39.968 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Feeding the <code>anova</code> function with different <span class="math inline">\tau</span> for the same model will conduct a joint test for the equality of slopes:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(rqfit2munich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Quantile Regression Analysis of Deviance Table

Model: rent ~ area + yearc + I(area^2) + I(yearc^2)
Joint Test of Equality of Slopes: tau in {  0.1 0.25 0.5 0.75 0.9  }

  Df Resid Df F value    Pr(&gt;F)    
1 16    15394  40.163 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We can visualize the <em>predicted quantiles</em> by looking at the effect of <code>area</code> on <code>rent</code> for different fixed values of <code>yearc</code>. We wish to show this in a <em>faceted</em> plot, so we will make use of the <code>expand_grid</code> function from the <code>tidyr</code> package.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>rqfit2munich <span class="sc">%&gt;%</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">expand_grid</span>(</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">area =</span> <span class="fu">seq</span>(</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">20</span>,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">140</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>        ), </span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">yearc =</span> <span class="fu">c</span>(</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1918</span>,</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1995</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>      area,</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>      .fitted,</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> .tau</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>yearc</span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Predicted Quantiles for Area"</span></span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>rqfit2munich <span class="sc">%&gt;%</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">expand_grid</span>(</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">area =</span> <span class="fu">c</span>(</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">20</span>,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">140</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">yearc =</span> <span class="fu">seq</span>(</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1918</span>,</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1995</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>      yearc, </span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>      .fitted, </span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> .tau</span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>area</span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Predicted Quantiles for Construction Year"</span></span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
<section id="more-intepretation-of-the-quantile-regression" class="level1">
<h1>More Intepretation of the Quantile Regression</h1>
<blockquote class="blockquote">
<p>What are the implications of the alernative hypothesis <span class="math inline">H_1: B^{(p)}_1 \neq B^{(q)}_1</span>?</p>
</blockquote>
<p>The main implication of this null hypothesis is that the <em>distribution</em> changes as a function of <span class="math inline">X</span>. We can describe the change in <em>scale</em> and <em>shape</em> using <em>quantile-based</em> measures; we already introduced them for the simple <em>univariate case</em><a href="#fn23" class="footnote-ref" id="fnref23" role="doc-noteref"><sup>23</sup></a>, and now we will extend them and compute them as a function of <span class="math inline">\mathbf{X}</span>.</p>
<p><span id="eq-QSCext"><span class="math display">
\begin{aligned}
QSC(p \vert X)
&amp;= Q(1 - p \vert X) - Q(p \vert X) = \\
&amp;= (\beta{(1 - p)}_0 - \beta^{(1 - p)}_1 X) - (\beta{(p)}_0 - \beta^{(p)}_1 X) = \\
&amp;=  (\beta{(1 - p)}_0 - \beta^{(p)}_0) + (\beta^{(1 - p)}_1 - \beta^{(p)}_1) X
\end{aligned}
\tag{29}</span></span></p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the scale is the same <span class="math inline">\beta^{(1 - p)}_1 = \beta^{(p)}_1</span>; hence, <span class="math inline">QSC(p \vert X)</span> reduces to a constant.</p>
</div>
</div>
<p><span id="eq-QSKext"><span class="math display">
\begin{aligned}
QSK(p \vert X)
&amp;= \frac{Q(1-p \vert X) - Q(.5 \vert X)}{Q(.5 \vert X) - Q(p \vert X)} - 1 =\\
&amp;= \frac{\beta^{(1 - p)}_0 + \beta^{(1 - p)}_1 X - \beta^{(.5)}_0 - \beta^{(.5)}_1 X}{\beta^{(.5)}_0 - \beta^{(.5)}_1 X -\beta^{(p)}_0 + \beta^{(p)}_1 X  } -1 = \\
&amp;= \frac{ (\beta^{(1 - p)}_0 - \beta^{(.5)}_0) + (\beta^{(1 - p)}_1 - \beta^{(.5)}_1) X}{ (\beta^{(.5)}_0 - \beta^{(p)}_0) + (\beta^{(.5)}_1 - \beta^{(p)}_1) X} -1
\end{aligned}
\tag{30}</span></span></p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Under <em>symmetry</em>, <span class="math inline">(\beta^{(1 - p)}_1 - \beta^{(.5)}_1) = (\beta^{(.5)}_1 - \beta^{(p)}_1)</span> and <span class="math inline">(\beta^{(1 - p)}_0 - \beta^{(.5)}_0) = (\beta^{(.5)}_0 - \beta^{(p)}_0)</span>; this implies that <span class="math inline">QSK(p \vert X)</span> reduces to 0.</p>
</div>
</div>
<section id="example-changes-in-the-distribution-properties" class="level2">
<h2 class="anchored" data-anchor-id="example-changes-in-the-distribution-properties">Example: Changes in the Distribution Properties</h2>
<blockquote class="blockquote">
<p>Once we have the predicted values for different quantiles we can also plot some measure of <em>scale</em> and <em>shape</em> as a function of some explanatory variable to assess whether this is changing: we compute <span class="math inline">QSC(0.25)</span> and <span class="math inline">QSK(0.9)</span> for <em>fixed values</em> of <code>yearc</code> and allowing <code>area</code> to vary:</p>
</blockquote>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>qs <span class="ot">&lt;-</span> rqfit2munich <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">expand_grid</span>(</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">area =</span> <span class="fu">seq</span>(</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">20</span>,</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">140</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">yearc =</span> <span class="fu">c</span>(</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1995</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from  =</span>.tau, </span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> .fitted</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">QSC025 =</span> <span class="st">`</span><span class="at">0.75</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">0.25</span><span class="st">`</span>,</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">QSK010 =</span> (<span class="st">`</span><span class="at">0.9</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">0.5</span><span class="st">`</span>)<span class="sc">/</span>(<span class="st">`</span><span class="at">0.5</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">0.1</span><span class="st">`</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(qs) <span class="sc">+</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>      area, </span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>      QSC025</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(qs) <span class="sc">+</span> </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>      area, </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>      QSK010</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>We will do now the same keeping a fixed value for <code>area</code> and allowing <code>yearc</code> to vary.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>qs <span class="ot">&lt;-</span> rqfit2munich <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">expand_grid</span>(</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">area =</span> <span class="fu">c</span>(<span class="dv">80</span>),</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">yearc =</span> <span class="fu">seq</span>(</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1918</span>, </span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1995</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from  =</span>.tau, </span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> .fitted</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">QSC025 =</span> <span class="st">`</span><span class="at">0.75</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">0.25</span><span class="st">`</span>, </span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">QSK010 =</span> (<span class="st">`</span><span class="at">0.9</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">0.5</span><span class="st">`</span>)<span class="sc">/</span>(<span class="st">`</span><span class="at">0.5</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">0.1</span><span class="st">`</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(qs) <span class="sc">+</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>      yearc, </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>      QSC025</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(qs) <span class="sc">+</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>      yearc, </span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>      QSK010</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BA-QR_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Any predictive or prescriptive model is based on some steps of <em>descriptive analytics</em>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This last one, however, is not strictly necessary.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This assumption allows for inference on the model parameters.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Warning: the mean is <em>not</em> a robust indicator of position.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Generalized Linear Models.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>In other words, it determines a specific point in the distribution. For example, the <em>median</em> is the quantile of order 0.5: you have a <span class="math inline">50%</span> probability of observing a value lower than the median.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>The mean of this distribution is 47.0563867.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>The basic example is a <em>linear transformation</em>, but this property also applies to <em>logarithms</em>.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>For example, <span class="math inline">Q(p, a + bY) = a + bQ(p, Y)</span>.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p><a href="#sec-intro">Section&nbsp;1</a>.<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>Well, no surprises here.<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>This is the same <em>loss function</em> used to find the median.s<a href="#fnref12" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn13"><p><span class="math inline">\tau = c(0.25, 0.5, 0.75)</span>.<a href="#fnref13" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn14"><p>It works similarly to the well-known <code>lm</code> function.<a href="#fnref14" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn15"><p><span class="math inline">(\beta_1^{(p)} - \beta_1^{(q)}) = 0</span>.<a href="#fnref15" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn16"><p><a href="#sec-inference">Section&nbsp;3.5</a>.<a href="#fnref16" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn17"><p>For example, an indication that we are observing a conditionally identically distributed response variable.<a href="#fnref17" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn18"><p>See <a href="#sec-inference">Section&nbsp;3.5</a>.<a href="#fnref18" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn19"><p>First introduced by Bradley Efron in the late 70s.<a href="#fnref19" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn20"><p>bias, variance, confidence intervals, prediction error, etc.<a href="#fnref20" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn21"><p>In the following notation the <span class="math inline">\tau</span> is omitted for readability.<a href="#fnref21" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn22"><p>This test amounts to asking the question: “Are the added variables <em>significant</em> in explaining the behavior of our dependent variable?”<a href="#fnref22" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn23"><p><a href="#sec-quantilebasedssunivariate">Section&nbsp;2.4</a>.<a href="#fnref23" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>